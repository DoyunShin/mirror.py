import mirror

from tempfile import TemporaryDirectory
from base64 import b64decode
from hashlib import sha256
from pathlib import Path
import subprocess
import logging
import os

ARCHVSYNC_VERSION = "20180513"
ARCHVSYNC_HASH = "a418df8b46ce54b7574f99daafe776204ed36425a113363c6bbe923dbbd19da4"

def ftpsync(package: mirror.structure.Package) -> None:
    """Sync package"""
    
    package.set_status("SYNC")

    os.setgid(mirror.conf.gid)
    os.setuid(mirror.conf.uid)

    logger = logging.getLogger(f"mirror.package.{package.name}")
    tmp = Path(TemporaryDirectory().name)
    tmp.mkdir()

    _setup(tmp, package)

    command = [
        f"{tmp}/bin/ftpsync",
    ]
    result = subprocess.run(command, shell=True, check=True)
    if result.returncode == 0:
        package.set_status("ACTIVE")
    else:
        package.set_status("ERROR")

def _setup(path: Path, package: mirror.structure.Package):
    """Setup package"""
    (path / "bin").mkdir()
    (path / "etc").mkdir()

    script = b64decode(ARCHVSYNC_SCRIPT)
    if sha256(script).hexdigest() != ARCHVSYNC_HASH:
        raise ValueError("Invalid hash")

    (path / "bin" / "ftpsync").write_bytes(script)
    (path / "bin" / "ftpsync").chmod(0o744)
    
    (path / "etc" / "ftpsync.conf").write_text(_config(package))


def _config(package: mirror.structure.Package) -> str:
    """Create config file"""
    config = ""
    config += f"MIRRORNAME=\"{mirror.conf.name}\"\n"
    config += f"TO=\"{package.settings.dst}\"\n"
    config += f"MAILTO=\"{package.settings.email}\"\n"
    config += f"HUB={package.settings.hub}\n"
    config += f"RSYNC_HOST=\"{package.settings.src}\"\n"
    config += f"RSYNC_PATH=\"{package.settings.path}\"\n"

    if "user" in dir(package.settings) and "password" in dir(package.settings):
        config += f"RSYNC_USER=\"{package.settings.user}\"\n"
        config += f"RSYNC_PASSWORD=\"{package.settings.password}\"\n"

    config += f"INFO_MAINTAINER=\"{package.settings.maintainer}\"\n" if "maintainer" in dir(package.settings) else ""
    config += f"INFO_SPONSOR=\"{package.settings.sponsor}\"\n" if "sponsor" in dir(package.settings) else ""
    config += f"INFO_COUNTRY={package.settings.country}\n" if "country" in dir(package.settings) else ""
    config += f"INFO_LOCATION=\"{package.settings.location}\"\n" if "location" in dir(package.settings) else ""
    config += f"INFO_THROUGHPUT={package.settings.throughput}\n" if "throughput" in dir(package.settings) else ""
    config += f"ARCH_INCLUDE=\"{package.settings.arch_include}\"\n" if "arch_include" in dir(package.settings) else ""
    config += f"ARCH_EXCLUDE=\"{package.settings.arch_exclude}\"\n" if "arch_exclude" in dir(package.settings) else ""
    config += f"LOGDIR=\"{package.settings.logdir if 'logdir' in dir(package.settings) else mirror.conf.logdir}\"\n" 

    return config




ARCHVSYNC_SCRIPT = """IyEvdXNyL2Jpbi9lbnYgYmFzaAojIE5vLCB3ZSBjYW4gbm90IGRlYWwgd2l0aCBzaCBhbG9uZS4KCnNldCAtZQpzZXQgLXUKIyBFUlIgdHJhcHMgc2hvdWxkIGJlIGluaGVyaXRlZCBmcm9tIGZ1bmN0aW9ucyB0b28uIChBbmQgY29tbWFuZAojIHN1YnN0aXR1dGlvbnMgYW5kIHN1YnNoZWxscyBhbmQgd2hhdG5vdCwgYnV0IGZvciB1cyB0aGUgZnVuY3Rpb24gaXMKIyB0aGUgaW1wb3J0YW50IHBhcnQgaGVyZSkKc2V0IC1FCgojIEEgcGlwZWxpbmUncyByZXR1cm4gc3RhdHVzIGlzIHRoZSB2YWx1ZSBvZiB0aGUgbGFzdCAocmlnaHRtb3N0KQojIGNvbW1hbmQgdG8gZXhpdCB3aXRoIGEgbm9uLXplcm8gc3RhdHVzLCBvciB6ZXJvIGlmIGFsbCBjb21tYW5kcyBleGl0CiMgc3VjY2VzcyBmdWxseS4Kc2V0IC1vIHBpcGVmYWlsCgojIGZ0cHN5bmMgc2NyaXB0IGZvciBEZWJpYW4KIyBCYXNlZCBsb3NlbHkgb24gYSBudW1iZXIgb2YgZXhpc3Rpbmcgc2NyaXB0cywgd3JpdHRlbiBieSBhbgojIHVua25vd24gbnVtYmVyIG9mIGRpZmZlcmVudCBwZW9wbGUgb3ZlciB0aGUgeWVhcnMuCiMKIyBDb3B5cmlnaHQgKEMpIDIwMDgtMjAxNiBKb2VyZyBKYXNwZXJ0IDxqb2VyZ0BkZWJpYW4ub3JnPgojIENvcHlyaWdodCAoQykgMjAxNiBQZXRlciBQYWxmcmFkZXIKIwojIFRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOyB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IKIyBtb2RpZnkgaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcwojIHB1Ymxpc2hlZCBieSB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uOyB2ZXJzaW9uIDIuCiMKIyBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwgYnV0CiMgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZgojIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGUgR05VCiMgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgojCiMgWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UKIyBhbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbTsgaWYgbm90LCB3cml0ZSB0byB0aGUgRnJlZSBTb2Z0d2FyZQojIEZvdW5kYXRpb24sIEluYy4sIDY3NSBNYXNzIEF2ZSwgQ2FtYnJpZGdlLCBNQSAwMjEzOSwgVVNBLgoKVkVSU0lPTj0iMjAxODA1MTMrbWlycm9yLnB5IgojIC0qLSBtb2RlOnNoIC0qLQojIHZpbTpzeW49c2gKIyBMaXR0bGUgY29tbW9uIGZ1bmN0aW9ucwoKIyBwdXNoIGEgbWlycm9yIGF0dGFjaGVkIHRvIHVzLgojIEFyZ3VtZW50cyAodXNpbmcgYW4gYXJyYXkgbmFtZWQgU0lHTkFMX09QVFMpOgojCiMgJE1JUlJPUiAgICAgIC0gTmFtZSBmb3IgdGhlIG1pcnJvciwgYWxzbyBiYXNlbmFtZSBmb3IgdGhlIGxvZ2ZpbGUKIyAkSE9TVE5BTUUgICAgLSBIb3N0bmFtZSB0byBwdXNoIHRvCiMgJFVTRVJOQU1FICAgIC0gVXNlcm5hbWUgdGhlcmUKIyAkU1NIUFJPVE8gICAgLSBQcm90b2NvbCB2ZXJzaW9uLCBlaXRoZXIgMSBvciAyLgojICRTU0hLRVkgICAgICAtIHRoZSBzc2ggcHJpdmF0ZSBrZXkgZmlsZSB0byB1c2UgZm9yIHRoaXMgcHVzaAojICRTU0hPUFRTICAgICAtIGFueSBvdGhlciBvcHRpb24gc3NoIGFjY2VwdHMsIHBhc3NlZCBibGluZGx5LCBiZSBjYXJlZnVsCiMgJFBVU0hMT0NLT1dOIC0gb3duIGxvY2tmaWxlIG5hbWUgdG8gdG91Y2ggYWZ0ZXIgc3RhZ2UxIGluIHB1c2h0eXBlPXN0YWdlZAojICRQVVNIVFlQRSAgICAtIHdoYXQga2luZCBvZiBwdXNoIHNob3VsZCBiZSBkb25lPwojICAgICAgICAgICAgICAgIGFsbCAgICAtIG5vcm1hbCwganVzdCBwdXNoIG9uY2Ugd2l0aCBzc2ggYmFja2dyb3VuZGVkIGFuZCBmaW5pc2gKIyAgICAgICAgICAgICAgICBzdGFnZWQgLSBzdGFnZWQuIGZpcnN0IHB1c2ggc3RhZ2UxLCB0aGVuIHdhaXQgZm9yICRQVVNITE9DS3MgdG8gYXBwZWFyLAojICAgICAgICAgICAgICAgICAgICAgICAgIHRoZW4gcHVzaCBzdGFnZTIKIyAkUFVTSEFSQ0hJVkUgLSB3aGF0IGFyY2hpdmUgdG8gc3luYz8gKE11bHRpcGxlIG1pcnJvcnMgYmVoaW5kIG9uZSBzc2gga2V5ISkKIyAkUFVTSENCICAgICAgLSBkbyB3ZSB3YW50IGEgY2FsbGJhY2s/CiMgJFBVU0hLSU5EICAgIC0gd2hhdHMgZ29pbmcgb24/IGFyZSB3ZSBkb2luZyBtaG9wIHB1c2ggb3IgYWxyZWFkeSBzdGFnZTI/CiMgJEZST01GVFBTWU5DIC0gc2V0IHRvIHRydWUgaWYgd2UgcnVuIGZyb20gd2l0aGluIGZ0cHN5bmMuCiMKIyBUaGlzIGZ1bmN0aW9uIGFzc3VtZXMgdGhhdCB0aGUgdmFyaWFibGUgTE9HIGlzIHNldCB0byBhIGRpcmVjdG9yeSB3aGVyZQojIGxvZ2ZpbGVzIGNhbiBiZSB3cml0dGVuIHRvLgojIEFkZGl0aW9uYWxseSAkUFVTSExPQ0tTIGhhcyB0byBiZSBkZWZpbmVkIGFzIGEgc2V0IG9mIHNwYWNlIGRlbGltaXRlZCBzdHJpbmdzCiMgKGxpc3Qgb2YgImxvY2siZmlsZXMpIHRvIHdhaXQgZm9yIGlmIHlvdSB3YW50IHB1c2h0eXBlPXN0YWdlZAojCiMgUHVzaGVzIG1pZ2h0IGJlIGRvbmUgaW4gYmFja2dyb3VuZCAoZm9yIHR5cGUgYWxsKS4Kc2lnbmFsICgpIHsKICAgIEFSR1M9IlNJR05BTF9PUFRTWypdIgogICAgbG9jYWwgJHshQVJHU30KCiAgICBNSVJST1I9JHtNSVJST1I6LSIifQogICAgSE9TVE5BTUU9JHtIT1NUTkFNRTotIiJ9CiAgICBVU0VSTkFNRT0ke1VTRVJOQU1FOi0iIn0KICAgIFNTSFBST1RPPSR7U1NIUFJPVE86LSIifQogICAgU1NIS0VZPSR7U1NIS0VZOi0iIn0KICAgIFNTSE9QVFM9JHtTU0hPUFRTOi0iIn0KICAgIFBVU0hMT0NLT1dOPSR7UFVTSExPQ0tPV046LSIifQogICAgUFVTSFRZUEU9JHtQVVNIVFlQRTotImFsbCJ9CiAgICBQVVNIQVJDSElWRT0ke1BVU0hBUkNISVZFOi0iIn0KICAgIFBVU0hDQj0ke1BVU0hDQjotIiJ9CiAgICBQVVNIS0lORD0ke1BVU0hLSU5EOi0iYWxsIn0KICAgIEZST01GVFBTWU5DPSR7RlJPTUZUUFNZTkM6LSJmYWxzZSJ9CgogICAgIyBBbmQgbm93IGdldCAjIGJhY2sgdG8gc3BhY2UuLi4KICAgIFNTSE9QVFM9JHtTU0hPUFRTL1wjLyB9CgogICAgIyBEZWZhdWx0cyB3ZSBhbHdheXMgd2FudCwgbm8gbWF0dGVyIHdoYXQKICAgIFNTSF9PUFRJT05TPSItbyB1c2VyPSR7VVNFUk5BTUV9IC1vIEJhdGNoTW9kZT15ZXMgLW8gU2VydmVyQWxpdmVJbnRlcnZhbD00NSAtbyBDb25uZWN0VGltZW91dD00NSAtbyBQYXNzd29yZEF1dGhlbnRpY2F0aW9uPW5vIgoKICAgICMgSWYgdGhlcmUgYXJlIHVzZXJkZWZpbmVkIHNzaCBvcHRpb25zLCBhZGQgdGhlbS4KICAgIGlmIFtbIC1uICR7U1NIX09QVFN9IF1dOyB0aGVuCiAgICAgICAgU1NIX09QVElPTlM9IiR7U1NIX09QVElPTlN9ICR7U1NIX09QVFN9IgogICAgZmkKCiAgICAjIERvZXMgdGhpcyBtYWNoaW5lIG5lZWQgYSBzcGVjaWFsIGtleT8KICAgIGlmIFtbIC1uICR7U1NIS0VZfSBdXTsgdGhlbgogICAgICAgIFNTSF9PUFRJT05TPSIke1NTSF9PUFRJT05TfSAtaSAke1NTSEtFWX0iCiAgICBmaQoKICAgICMgRG9lcyB0aGlzIG1hY2hpbmUgaGF2ZSBhbiBleHRyYSBvd24gc2V0IG9mIHNzaCBvcHRpb25zPwogICAgaWYgW1sgLW4gJHtTU0hPUFRTfSBdXTsgdGhlbgogICAgICAgIFNTSF9PUFRJT05TPSIke1NTSF9PUFRJT05TfSAke1NTSE9QVFN9IgogICAgZmkKCiAgICAjIFNldCB0aGUgcHJvdG9jb2wgdmVyc2lvbgogICAgaWYgW1sgJHtTU0hQUk9UT30gLW5lIDEgXV0gJiYgW1sgJHtTU0hQUk9UT30gLW5lIDIgXV0gJiYgW1sgJHtTU0hQUk9UT30gLW5lIDk5IF1dOyB0aGVuCiAgICAgICAgIyBJZGlvdHMsIHdlIG9ubHkgd2FudCAxIG9yIDIuIENhbnQgZGVjaWRlPyBMZXRzIGZvcmNlIDIuCiAgICAgICAgU1NIUFJPVE89MgogICAgZmkKCiAgICBpZiBbWyAtbiAke1NTSFBST1RPfSBdXSAmJiBbWyAke1NTSFBST1RPfSAtbmUgOTkgXV07IHRoZW4KICAgICAgICBTU0hfT1BUSU9OUz0iJHtTU0hfT1BUSU9OU30gLSR7U1NIUFJPVE99IgogICAgZmkKCiAgICBkYXRlIC11ID4+ICIke0xPR0RJUn0vJHtNSVJST1J9LmxvZyIKCiAgICBQVVNIQVJHUz0iIgogICAgIyBQVVNIQVJDSElWRSBlbXB0eSBvciBub3QsIHdlIGFsd2F5cyBhZGQgdGhlIHN5bmM6YXJjaGl2ZTogY29tbWFuZCB0byB0cmFuc2Zlci4KICAgICMgT3RoZXJ3aXNlLCBpZiBub3RoaW5nIGVsc2UgaXMgYWRkZWQsIHNzaCAtZiB3b3VsZCBub3Qgd29yayAoIm5vIGNvbW1hbmQgdG8gZXhlY3V0ZSIpCiAgICAjIEJ1dCBmdHBzeW5jIGRvZXMgdHJlYXQgInN5bmM6YXJjaGl2ZToiIGFzIHRoZSBtYWluIGFyY2hpdmUsIHNvIHRoaXMgd29ya3MgbmljZWx5LgogICAgUFVTSEFSR1M9IiR7UFVTSEFSR1N9IHN5bmM6YXJjaGl2ZToke1BVU0hBUkNISVZFfSIKCiAgICAjIFdlIGhhdmUgYSBjYWxsYmFjayB3aXNoLCB0ZWxsIGRvd25zdHJlYW1zCiAgICBpZiBbWyAtbiAke1BVU0hDQn0gXV07IHRoZW4KICAgICAgICBQVVNIQVJHUz0iJHtQVVNIQVJHU30gc3luYzpjYWxsYmFjayIKICAgIGZpCiAgICAjIElmIHdlIGFyZSBydW5uaW5nIGFuIG1ob3AgcHVzaCBBTkQgb3VyIGRvd25zdHJlYW0gaXMgb25lIHRvIHJlY2VpdmUgaXQsIHRlbGwgaXQuCiAgICBpZiBbWyBtaG9wID0gJHtQVVNIS0lORH0gXV0gJiYgW1sgbWhvcCA9ICR7UFVTSFRZUEV9IF1dOyB0aGVuCiAgICAgICAgUFVTSEFSR1M9IiR7UFVTSEFSR1N9IHN5bmM6bWhvcCIKICAgIGZpCgogICAgaWYgW1sgYWxsID0gJHtQVVNIVFlQRX0gXV07IHRoZW4KICAgICAgICAjIERlZmF1bHQgbm9ybWFsICJmaXJlIGFuZCBmb3JnZXQiIHB1c2guIFdlIGJhY2tncm91bmQgdGhhdCwgd2UgZG8gbm90IGNhcmUgYWJvdXQgdGhlIG1pcnJvcnMgZG9pbmdzCiAgICAgICAgUFVTSEFSR1MxPSJzeW5jOmFsbCIKICAgICAgICBzaWduYWxfc3NoICJub3JtYWwiICIke01JUlJPUn0iICIke0hPU1ROQU1FfSIgJFNTSF9PUFRJT05TICIke1BVU0hBUkdTfSAke1BVU0hBUkdTMX0iCiAgICBlbGlmIFtbIHN0YWdlZCA9ICR7UFVTSFRZUEV9IF1dIHx8IFtbIG1ob3AgPSAke1BVU0hUWVBFfSBdXTsgdGhlbgogICAgICAgICMgV2FudCBhIHN0YWdlZCBwdXNoLiBGaW5lLCBsZXRzIGRvIHRoYXQuIE5vdCBiYWNrZ3JvdW5kZWQuIFdlIGNhcmUgYWJvdXQgdGhlIG1pcnJvcnMgZG9pbmdzLgogICAgICAgICMgT25seSBzZW5kIHN0YWdlMSBpZiB3ZSBoYXZlbnQgYWxyZWFkeSBzZW5kIGl0LiBXaGVuIGNhbGxlZCB3aXRoIHN0YWdlMiwgd2UgYWxyZWFkeSBkaWQuCiAgICAgICAgaWYgW1sgc3RhZ2UyICE9ICR7UFVTSEtJTkR9IF1dOyB0aGVuCiAgICAgICAgICAgICMgU3RlcDE6IERvIGEgcHVzaCB0byBvbmx5IHN5bmMgc3RhZ2UxLCBkbyBub3QgYmFja2dyb3VuZAogICAgICAgICAgICBQVVNIQVJHUzE9InN5bmM6c3RhZ2UxIgogICAgICAgICAgICBzaWduYWxfc3NoICJmaXJzdCBzdGFnZSIgIiR7TUlSUk9SfSIgIiR7SE9TVE5BTUV9IiAkU1NIX09QVElPTlMgIiR7UFVTSEFSR1N9ICR7UFVTSEFSR1MxfSIKICAgICAgICAgICAgdG91Y2ggIiR7UFVTSExPQ0tPV059IgoKICAgICAgICAgICAgIyBTdGVwMjogV2FpdCBmb3IgYWxsIHRoZSBvdGhlciAibG9jayJmaWxlcyB0byBhcHBlYXIuCiAgICAgICAgICAgICMgSW4gY2FzZSB3ZSBkaWQgbm90IGhhdmUgYWxsIFBVU0hMT0NLUyBhbmQgc3RpbGwgY29udGludWVkLCBub3RlIGl0CiAgICAgICAgICAgICMgVGhpcyBpcyBhIGxpdHRsZSByYWN5LCBlc3BlY2lhbGx5IGlmIHRoZSBvdGhlciBwYXJ0cyBkZWNpZGUgdG8gZG8gdGhpcwogICAgICAgICAgICAjIGF0IHRoZSBzYW1lIHRpbWUsIGJ1dCBpdCB3b250IGh1cnQgbW9yZSB0aGFuIGEgbWFpbCB0b28gbXVjaCwgc28gSSBkb24ndCBjYXJlIG11Y2gKICAgICAgICAgICAgaWYgISB3YWl0X2Zvcl9wdXNobG9ja3MgJHtQVVNIREVMQVl9OyB0aGVuCiAgICAgICAgICAgICAgICBtc2cgIkZhaWxlZCB0byB3YWl0IGZvciBhbGwgb3RoZXIgbWlycm9ycy4gRmFpbGVkIG9uZXMgYXJlOiIgPj4gIiR7TE9HRElSfS8ke01JUlJPUn0ubG9nIgogICAgICAgICAgICAgICAgZm9yIGZpbGUgaW4gJHtQVVNITE9DS1N9OyBkbwogICAgICAgICAgICAgICAgICAgIGlmIFtbICEgLWYgJHtmaWxlfSBdXTsgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBtc2cgIiR7ZmlsZX0iID4+ICIke0xPR0RJUn0vJHtNSVJST1J9LmxvZyIKICAgICAgICAgICAgICAgICAgICAgICAgbG9nICJNaXNzaW5nIFB1c2hsb2NrZmlsZSAke2ZpbGV9IGFmdGVyIHdhaXRpbmcgZm9yIG1vcmUgdGhhbiAke1BVU0hERUxBWX0gc2Vjb25kcywgY29udGludWluZyIKICAgICAgICAgICAgICAgICAgICBmaQogICAgICAgICAgICAgICAgZG9uZQogICAgICAgICAgICBmaQogICAgICAgICAgICBybSAtZiAiJHtQVVNITE9DS09XTn0iCiAgICAgICAgZmkKCiAgICAgICAgIyBTdGVwMzogSXQgZWl0aGVyIHRpbWVkIG91dCBvciB3ZSBoYXZlIGFsbCB0aGUgImxvY2siZmlsZXMsIGRvIHRoZSByZXN0CiAgICAgICAgIyBJZiB3ZSBhcmUgZG9pbmcgbWhvcCBBTkQgYXJlIGNhbGxlZCBmcm9tIGZ0cHN5bmMgLSB3ZSBub3cgZXhpdC4KICAgICAgICAjIFRoYXQgd2F5IHdlIG5vdGlmeSBvdXIgdXBsaW5rIHRoYXQgd2UgYW5kIGFsbCBvdXIgY2xpZW50cyBhcmUgZG9uZSB3aXRoIHRoZWlyCiAgICAgICAgIyBzdGFnZTEuIEl0IGNhbiB0aGVuIGZpbmlzaCBpdHMgb3duLCBhbmQgaWYgYWxsIG91ciB1cHN0cmVhbXMgZG93bmxpbmtzIGFyZSBkb25lLAogICAgICAgICMgaXQgd2lsbCBzZW5kIHVzIHN0YWdlMi4KICAgICAgICAjIElmIHdlIGFyZSBub3QgZG9pbmcgbWhvcCBvciBhcmUgbm90IGNhbGxlZCBmcm9tIGZ0cHN5bmMsIHdlIHN0YXJ0IHN0YWdlMgogICAgICAgIGlmIFtbIHRydWUgPSAke0ZST01GVFBTWU5DfSBdXSAmJiBbWyBtaG9wID0gJHtQVVNIS0lORH0gXV07IHRoZW4KICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgZWxzZQogICAgICAgICAgICBQVVNIQVJHUzI9InN5bmM6c3RhZ2UyIgogICAgICAgICAgICBzaWduYWxfc3NoICJzZWNvbmQgc3RhZ2UiICIke01JUlJPUn0iICIke0hPU1ROQU1FfSIgJFNTSF9PUFRJT05TICIke1BVU0hBUkdTfSAke1BVU0hBUkdTMn0iCiAgICAgICAgZmkKICAgIGVsc2UKICAgICAgICAjIENhbid0IGRlY2lkZT8gVGhlbiB5b3UgZ2V0IG5vdGhpbmcuCiAgICAgICAgcmV0dXJuCiAgICBmaQp9CgpzaWduYWxfc3NoKCkgewogICAgbG9jYWwgdD0kMQogICAgbG9jYWwgbWlycm9yX2xvZz0iJHtMT0dESVJ9LyR7Mn0ubG9nIgogICAgbG9jYWwgaG9zdG5hbWU9JDMKICAgIHNoaWZ0IDMKCiAgICBtc2cgIlNlbmRpbmcgJHt0fSB0cmlnZ2VyIiA+PiAkbWlycm9yX2xvZwogICAgb3V0cHV0PSQoc3NoIC1uICRob3N0bmFtZSAiJEAiIDI+JjEgfCB0ZWUgLWEgJG1pcnJvcl9sb2cpCiAgICBpZiBbWyAkPyAtZXEgMjU1IF1dOyB0aGVuCiAgICAgICAgZXJyb3JfbWFpbGYgIiR7dH0gdHJpZ2dlciBmYWlsZWQ6ICRob3N0bmFtZSIgLWIgIiRvdXRwdXQiCiAgICBlbHNlCiAgICAgICAgbG9nICIke3R9IHRyaWdnZXIgc3VjY2VlZGVkOiAkaG9zdG5hbWUiCiAgICBmaQp9Cgp3YWl0X2Zvcl9wdXNobG9ja3MoKSB7CiAgbG9jYWwgdHJpZXM9MAogIGxvY2FsIGZvdW5kCiAgbG9jYWwgdG90YWwKICBsb2NhbCB0aW1lb3V0PSR7MX07IHNoaWZ0CiAgIyBXZSBkbyBub3Qgd2FpdCBmb3JldmVyCiAgd2hpbGUgW1sgJHt0cmllc30gLWx0ICR7dGltZW91dH0gXV07IGRvCiAgICAgIHRvdGFsPTAKICAgICAgZm91bmQ9MAogICAgICBmb3IgZmlsZSBpbiAke1BVU0hMT0NLU307IGRvCiAgICAgICAgICB0b3RhbD0kKCggdG90YWwgKyAxICkpCiAgICAgICAgICBpZiBbWyAtZiAke2ZpbGV9IF1dOyB0aGVuCiAgICAgICAgICAgICAgZm91bmQ9JCgoIGZvdW5kICsgMSApKQogICAgICAgICAgZmkKICAgICAgZG9uZQogICAgICBpZiBbWyAke3RvdGFsfSAtZXEgJHtmb3VuZH0gXV0gfHwgW1sgLWYgJHtMT0NLRElSfS9hbGxfc3RhZ2UxIF1dOyB0aGVuCiAgICAgICAgICBicmVhawogICAgICBmaQogICAgICB0cmllcz0kKCggdHJpZXMgKyA1ICkpCiAgICAgIHNsZWVwIDUKICBkb25lCiAgIyBSZWdhcmRsZXNzIG9mIHRoZSBzdGF0ZSBvZiBvdXIgc2libGluZ3MsIGhpdHRpbmcgb25lIHRpbWVvdXQgY2FuY2VscyBhbGwgd2FpdHMKICB0b3VjaCAiJHtMT0NLRElSfS9hbGxfc3RhZ2UxIgogIGlmIFtbICR7dHJpZXN9IC1nZSAke3RpbWVvdXR9IF1dOyB0aGVuCiAgICByZXR1cm4gMQogIGVsc2UKICAgIHJldHVybiAwCiAgZmkKfQoKIyBjYWxsYmFjaywgdXNlZCBieSBmdHBzeW5jCmNhbGxiYWNrICgpIHsKICAgICMgRGVmYXVsdHMgd2UgYWx3YXlzIHdhbnQsIG5vIG1hdHRlciB3aGF0CiAgICBTU0hfT1BUSU9OUz0iLW8gQmF0Y2hNb2RlPXllcyAtbyBTZXJ2ZXJBbGl2ZUludGVydmFsPTQ1IC1vIENvbm5lY3RUaW1lb3V0PTQ1IC1vIFBhc3N3b3JkQXV0aGVudGljYXRpb249bm8iCiAgICBzc2ggLW4gJFNTSF9PUFRJT05TIC1pICIkMyIgLW8idXNlciAkMSIgIiQyIiBjYWxsYmFjazoke0hPU1ROQU1FfQp9CgojIG9wZW4gbG9nIGZpbGUKb3Blbl9sb2coKSB7CiAgICBsb2NhbCBsb2c9JDEKICAgIHNoaWZ0CiAgICBleGVjIDQ+JjEgMT4+JGxvZwp9CgojIGFzc2VtYmxlIGxvZyBtZXNzYWdlIChiYXNpY2FsbHkgZWNobyBpdCB0b2dldGhlciB3aXRoIGEgdGltZXN0YW1wKQojCiMgU2V0ICRQUk9HUkFNIHRvIGEgc3RyaW5nIHRvIGhhdmUgaXQgYWRkZWQgdG8gdGhlIG91dHB1dC4KbXNnKCkgewogICAgaWYgW1sgLXogIiR7UFJPR1JBTX0iIF1dOyB0aGVuCiAgICAgICAgZWNobyAiJChkYXRlICsiJWIgJWQgJUg6JU06JVMiKSAkKGhvc3RuYW1lIC1zKSBbJCRdICRAIgogICAgZWxzZQogICAgICAgIGVjaG8gIiQoZGF0ZSArIiViICVkICVIOiVNOiVTIikgJChob3N0bmFtZSAtcykgJHtQUk9HUkFNfVskJF06ICRAIgogICAgZmkKfQoKIyBsb2cgc29tZXRoaW5nCmxvZygpIHsKICAgIG1zZyAiJEAiCn0KCiMgbG9nIHRoZSBtZXNzYWdlIHVzaW5nIGxvZygpIGJ1dCB0aGVuIGFsc28gc2VuZCBhIG1haWwKIyB0byB0aGUgYWRkcmVzcyBjb25maWd1cmVkIGluIE1BSUxUTyAoaWYgbm9uLWVtcHR5KQplcnJvciAoKSB7CiAgICBsb2cgIiRAIgogICAgTE9HX0VSUk9SPTEKICAgIG1haWxmIC1zICJbJFBST0dSQU1AJChob3N0bmFtZSAtcyldIEVSUk9SOiAkKiIgLWIgIiQqIiAke01BSUxUT30KfQoKIyBsb2cgdGhlIG1lc3NhZ2UgdXNpbmcgbG9nKCkgYnV0IHRoZW4gYWxzbyBzZW5kIGEgbWFpbAojIHRvIHRoZSBhZGRyZXNzIGNvbmZpZ3VyZWQgaW4gTUFJTFRPIChpZiBub24tZW1wdHkpCmVycm9yX21haWxmICgpIHsKICAgIGxvY2FsIG09IiQxIgogICAgc2hpZnQKICAgIGxvZyAiJG0iCiAgICBMT0dfRVJST1I9MQogICAgbWFpbGYgLXMgIlskUFJPR1JBTUAkKGhvc3RuYW1lIC1zKV0gRVJST1I6ICRtIiAiJEAiICR7TUFJTFRPfQp9CgojIHJ1biBhIGhvb2sKIyBuZWVkcyBhcnJheSB2YXJpYWJsZSBIT09LIHNldHVwIHdpdGggSE9PS05SIGJlaW5nIGEgbnVtYmVyIGFuIEhPT0tTQ1IKIyB0aGUgc2NyaXB0IHRvIHJ1bi4KaG9vayAoKSB7CiAgICBBUkdTPSdIT09LW0BdJwogICAgbG9jYWwgIiR7IUFSR1N9IgogICAgaWYgW1sgLW4gJHtIT09LU0NSfSBdXTsgdGhlbgogICAgICAgIGxvZyAiUnVubmluZyBob29rICRIT09LTlI6ICR7SE9PS1NDUn0iCiAgICAgICAgc2V0ICtlCiAgICAgICAgJHtIT09LU0NSfQogICAgICAgIHJlc3VsdD0kPwogICAgICAgIHNldCAtZQogICAgICAgIGlmIFtbICR7cmVzdWx0fSAtbmUgMCBdXSA7IHRoZW4KICAgICAgICAgICAgZXJyb3IgIkJhY2sgZnJvbSBob29rICRIT09LTlIsIGdvdCByZXR1cm5jb2RlICR7cmVzdWx0fSIKICAgICAgICBlbHNlCiAgICAgICAgICAgIGxvZyAiQmFjayBmcm9tIGhvb2sgJEhPT0tOUiwgZ290IHJldHVybmNvZGUgJHtyZXN1bHR9IgogICAgICAgIGZpCiAgICAgICAgcmV0dXJuICRyZXN1bHQKICAgIGVsc2UKICAgICAgICByZXR1cm4gMAogICAgZmkKfQoKIyBSZXR1cm4gdGhlIGxpc3Qgb2YgMi1zdGFnZSBtaXJyb3JzLgpnZXQyc3RhZ2UoKSB7CiAgICBlZ3JlcCAtcyAnXihzdGFnZWR8bWhvcCknICIke01JUlJPUlN9IiB8IHsKICAgICAgICB3aGlsZSByZWFkIE1UWVBFIE1MTkFNRSBNSE9TVE5BTUUgTVVTRVIgTVBST1RPIE1LRVlGSUxFOyBkbwogICAgICAgICAgICBQVVNITE9DS1M9IiR7TE9DS0RJUn0vJHtNTE5BTUV9LnN0YWdlMSAke1BVU0hMT0NLU30iCiAgICAgICAgZG9uZQogICAgICAgIGVjaG8gIiRQVVNITE9DS1MiCiAgICB9Cn0KCiMgUm90YXRlIGxvZ2ZpbGVzCnNhdmVsb2coKSB7CiAgICB0b3JvdGF0ZT0iJDEiCiAgICBjb3VudD0kezI6LSR7TE9HUk9UQVRFfX0KICAgIHdoaWxlIFtbICR7Y291bnR9IC1ndCAwIF1dOyBkbwogICAgICAgIHByZXY9JCgoIGNvdW50IC0gMSApKQogICAgICAgIGlmIFtbIC1lICR7dG9yb3RhdGV9LiR7cHJldn0gXV07IHRoZW4KICAgICAgICAgICAgbXYgIiR7dG9yb3RhdGV9LiR7cHJldn0iICIke3Rvcm90YXRlfS4ke2NvdW50fSIKICAgICAgICBmaQogICAgICAgIGNvdW50PSRwcmV2CiAgICBkb25lCiAgICBpZiBbWyAtZSAke3Rvcm90YXRlfSBdXTsgdGhlbgogICAgICAgIG12ICIke3Rvcm90YXRlfSIgIiR7dG9yb3RhdGV9LjAiCiAgICBmaQp9CgojIFJldHVybiByc3luYyB2ZXJzaW9uCnJzeW5jX3Byb3RvY29sKCkgewogICAgUlNZTkNfVkVSU0lPTj0iJCgke1JTWU5DfSAtLXZlcnNpb24pIgogICAgUlNZTkNfUkVHRVg9Iihwcm90b2NvbFsgXSt2ZXJzaW9uWyBdKyhbMC05XSspKSIgICAgCiAgICBpZiBbWyAke1JTWU5DX1ZFUlNJT059ID1+ICR7UlNZTkNfUkVHRVh9IF1dOyB0aGVuCiAgICAgICAgZWNobyAke0JBU0hfUkVNQVRDSFsyXX0KICAgIGZpCiAgICB1bnNldCBSU1lOQ19WRVJTSU9OIFJTWU5DX1JFR0VYCn0KCmV4dHJhY3RfdHJhY2VfZmllbGQoKSB7CiAgICBsb2NhbCBmaWVsZD0iJDEiCiAgICBsb2NhbCBmaWxlPSIkMiIKICAgIGxvY2FsIHZhbHVlPSQoYXdrIC1GJzogJyAiXCQxPT1cIiRmaWVsZFwiIHtwcmludCBcJDI7IGV4aXR9IiAiJGZpbGUiIDI+L2Rldi9udWxsKQogICAgW1sgJHZhbHVlIF1dIHx8IHJldHVybiAxCiAgICBlY2hvICR2YWx1ZQp9CgpleHRyYWN0X3RyYWNlX2ZpZWxkX3N0cmluZygpIHsKICAgIGxvY2FsIGZpZWxkPSIkMSIKICAgIGxvY2FsIHN0cmluZz0iJDIiCiAgICBsb2NhbCB2YWx1ZT0kKGF3ayAtRic6ICcgIlwkMT09XCIkZmllbGRcIiB7cHJpbnQgXCQyOyBleGl0fSIgPDw8ICIkc3RyaW5nIiAyPi9kZXYvbnVsbCkKICAgIFtbICR2YWx1ZSBdXSB8fCByZXR1cm4gMQogICAgZWNobyAkdmFsdWUKfQoKZXh0cmFjdF90cmFjZV9zZXJpYWwoKSB7CiAgICBleHRyYWN0X3RyYWNlX2ZpZWxkICdBcmNoaXZlIHNlcmlhbCcgIiQxIgogICAgcmV0dXJuICQ/Cn0KCmV4dHJhY3RfdHJhY2Vfc2VyaWFsX3N0cmluZygpIHsKICAgIGV4dHJhY3RfdHJhY2VfZmllbGRfc3RyaW5nICdBcmNoaXZlIHNlcmlhbCcgIiQxIgogICAgcmV0dXJuICQ/Cn0KCiMgU2VhcmNoIGNvbmZpZyBmaWxlcyBpbiB2YXJpb3VzIGxvY2F0aW9ucwpzZWFyY2hfY29uZmlnKCkgewogIGxvY2FsIGZpbGUKICBmb3IgaSBpbiAke0NPTkZESVJTW0BdfTsgZG8KICAgIGZpbGU9IiRpLyQxIgogICAgaWYgWyAtZiAiJGZpbGUiIF07IHRoZW4KICAgICAgZWNobyAiJGZpbGUiCiAgICAgIHJldHVybgogICAgZmkKICBkb25lCn0KCiMgUmVhZCBjb25maWcgZmlsZQpyZWFkX2NvbmZpZygpIHsKICBsb2NhbCBuYW1lPSQoZWNobyAiJDEiIHwgc2VkIC1lICdzL1teQS1aYS16MC05Ll8tXS9fL2cnKQogIGxvY2FsIGNvbmZpZz0kKHNlYXJjaF9jb25maWcgIiRuYW1lIikKICBpZiBbICIkY29uZmlnIiBdOyB0aGVuCiAgICAuICIkY29uZmlnIgogICAgQ1VSUkVOVF9DT05GSUc9IiRjb25maWciCiAgICByZXR1cm4gMAogIGVsc2UKICAgIGVjaG8gIkNhbid0IHJlYWQgY29uZmlnIGZpbGUgJHtuYW1lfSEiID4mMgogICAgZXhpdCA3OCAjIEVYX0NPTkZJRwogIGZpCn0KCiMgQ3JlYXRlIGxvY2sgZGlyCmNyZWF0ZV9sb2NrZGlyKCkgewogIG1rZGlyIC1wICIkTE9DS0RJUiIKfQoKIyBDcmVhdGUgbG9nIGRpcgpjcmVhdGVfbG9nZGlyKCkgewogIG1rZGlyIC1wICIkTE9HRElSIgp9Cgpqb2luX2J5KCkgewogICAgbG9jYWwgSUZTPSIkMSIKICAgIHNoaWZ0CiAgICBlY2hvICQqCn0KCiMgU2VuZHMgbWFpbAojIG1haWxmIFstYSBhdHRhY2htZW50XSBbLWIgYm9keV0gWy1zIHN1YmplY3RdIHRvLWFkZHIgLi4uCm1haWxmKCkgewogICAgbG9jYWwgYm91bmRhcnk9Ij09LS0kUkFORE9NLS0kUkFORE9NLS0kUkFORE9NLS09PSIKICAgIGxvY2FsIGF0dGFjaG1lbnQ9KCkKICAgIGxvY2FsIGJvZHk9KCkKICAgIGxvY2FsIHN1YmplY3Q9CgogICAgT1BUSU5EPTEKICAgIHdoaWxlIGdldG9wdHMgIjphOmI6czoiIGFyZzsgZG8KICAgICAgICBjYXNlICRhcmcgaW4KICAgICAgICAgICAgYSkKICAgICAgICAgICAgICAgIGF0dGFjaG1lbnQrPSgiJE9QVEFSRyIpCiAgICAgICAgICAgICAgICA7OwogICAgICAgICAgICBiKQogICAgICAgICAgICAgICAgYm9keSs9KCIkT1BUQVJHIikKICAgICAgICAgICAgICAgIDs7CiAgICAgICAgICAgIHMpCiAgICAgICAgICAgICAgICBzdWJqZWN0PSIkT1BUQVJHIgogICAgICAgICAgICAgICAgOzsKICAgICAgICBlc2FjCiAgICBkb25lCiAgICBzaGlmdCAkKChPUFRJTkQtMSkpCgogICAgKAogICAgICAgIGNhdCA8PEVPRgpTdWJqZWN0OiAke3N1YmplY3R9ClRvOiAkKGpvaW5fYnkgJywgJyAiJEAiKQpBdXRvLVN1Ym1pdHRlZDogYXV0by1nZW5lcmF0ZWQKTUlNRS1WZXJzaW9uOiAxLjAKQ29udGVudC1UeXBlOiBtdWx0aXBhcnQvbWl4ZWQ7IGJvdW5kYXJ5PSR7Ym91bmRhcnl9CgpFT0YKICAgICAgICBpZiBbWyAke2JvZHlbQF06LX0gXV07IHRoZW4KICAgICAgICAgICAgZm9yIGEgaW4gIiR7Ym9keVtAXX0iOyBkbwogICAgICAgICAgICAgICAgY2F0IDw8RU9GCi0tJHtib3VuZGFyeX0KQ29udGVudC10eXBlOiB0ZXh0L3BsYWluCgpFT0YKICAgICAgICAgICAgICAgIGVjaG8gIiRhIgogICAgICAgICAgICBkb25lCiAgICAgICAgZmkKICAgICAgICBpZiBbWyAke2F0dGFjaG1lbnRbQF06LX0gXV07IHRoZW4KICAgICAgICAgICAgZm9yIGEgaW4gIiR7YXR0YWNobWVudFtAXX0iOyBkbwogICAgICAgICAgICAgICAgY2F0IDw8RU9GCi0tJHtib3VuZGFyeX0KQ29udGVudC10eXBlOiB0ZXh0L3BsYWluOyBuYW1lPSIkKGJhc2VuYW1lICRhKSIKCkVPRgogICAgICAgICAgICAgICAgY2F0ICIkYSIgfHwgZWNobyAiRmFpbGVkIHRvIGF0dGFjaCAkYSIKICAgICAgICAgICAgZG9uZQogICAgICAgIGZpCiAgICAgICAgY2F0IDw8RU9GCi0tJHtib3VuZGFyeX0tLQpFT0YKICAgICkgfCAvdXNyL3NiaW4vc2VuZG1haWwgLWkgLS0gIiRAIiB8fCA6Cn0KIyAtKi0gbW9kZTpzaCAtKi0KIyB2aW06c3luPXNoCgpCSU5ESVI9JChkaXJuYW1lICQocmVhZGxpbmsgLWYgIiQwIikpCkJBU0VESVI9JHtCQVNFRElSOi0iJChyZWFkbGluayAtZiAkKGRpcm5hbWUgIiQwIikvLi4pIn0KQ09ORkRJUlM9KCIke0JBU0VESVJ9L2V0YyIgfi8uY29uZmlnL2Z0cHN5bmMgL2V0Yy9mdHBzeW5jKQpMT0NLRElSPSIke0JBU0VESVJ9L2xvY2tzIgpMT0dESVI9IiR7QkFTRURJUn0vbG9nIgoKZnVuY3Rpb24gc2VuZF9tYWlsX25ld192ZXJzaW9uKCkgewogICAgIyBDaGVjayBpZiB0aGVyZSBpcyBhIG5ld2VyIHZlcnNpb24gb2YgZnRwc3luYy4gSWYgc28gaW5mb3JtIHRoZSBhZG1pbiwgYnV0IG5vdAogICAgIyBtb3JlIHRoYW4gb25jZSBldmVyeSB0aGlyZCBkYXkuCiAgICBpZiBbWyAtciAke1RPfS9wcm9qZWN0L2Z0cHN5bmMvTEFURVNULlZFUlNJT04gXV07IHRoZW4KICAgICAgICBMQVRFU1Q9JCg8ICIke1RPfS9wcm9qZWN0L2Z0cHN5bmMvTEFURVNULlZFUlNJT04iKQogICAgICAgIGlmIFtbICR7VkVSU0lPTn0gPX4gXlswLTldKyQgXV0gJiYgW1sgJHtMQVRFU1R9ID1+IF5bMC05XSskIF1dICYmCiAgICAgICAgICAgIFtbICR7TEFURVNUfSAtZ3QgJHtWRVJTSU9OfSBdXTsgdGhlbgogICAgICAgICAgICBpZiBbWyAtbiAke01BSUxUT30gXV07IHRoZW4KICAgICAgICAgICAgICAgIGludGVydmFsPSQoKDcgKiAyNCAqIDM2MDApKQogICAgICAgICAgICAgICAgZGlmZmVyZW5jZT0kaW50ZXJ2YWwKICAgICAgICAgICAgICAgIGlmIFtbIC1mICR7TE9HRElSfS9mdHBzeW5jLm5ld3ZlcnNpb24gXV07IHRoZW4KICAgICAgICAgICAgICAgICAgICBzdGFtcHRpbWU9JCg8ICIke0xPR0RJUn0vZnRwc3luYy5uZXd2ZXJzaW9uIikKICAgICAgICAgICAgICAgICAgICB1bml4dGltZT0kKGRhdGUgKyVzKQogICAgICAgICAgICAgICAgICAgIGRpZmZlcmVuY2U9JCgoICR1bml4dGltZSAtICRzdGFtcHRpbWUgKSkKICAgICAgICAgICAgICAgIGZpCiAgICAgICAgICAgICAgICBpZiBbWyAke2RpZmZlcmVuY2V9IC1nZSAkaW50ZXJ2YWwgXV07IHRoZW4KICAgICAgICAgICAgICAgICAgICAjIE9ubHkgd2FybiBldmVyeSBzZXZlbnRoIGRheQogICAgICAgICAgICAgICAgICAgIG1haWxmIC1zICJbJChob3N0bmFtZSAtcyldIFVwZGF0ZSBmb3IgZnRwc3luYyBhdmFpbGFibGUiIC1iICJIZWxsbyBhZG1pbiwKCmkgZm91bmQgdGhhdCB0aGVyZSBpcyBhIG5ldyB2ZXJzaW9uIG9mIG1lIGF2YWlsYWJsZS4KTWUgbG9uZWx5IGZ0cHN5bmMgaXMgY3VycmVudGx5IHZlcnNpb246ICR7VkVSU0lPTn0KTmV3IHJlbGVhc2Ugb2YgbXlzZWxmIGlzIGF2YWlsYWJsZSBhczogICR7TEFURVNUfQoKTWUsIG15c2VsZiBhbmQgSSAtIGFuZCB0aGUgRGViaWFuIG1pcnJvcmFkbWlucyAtIHdvdWxkIGJlIHZlcnkgZ3JhdGVmdWwKaWYgeW91IGNvdWxkIHVwZGF0ZSBtZS4gWW91IGNhbiBmaW5kIHRoZSBsYXRlc3QgdmVyc2lvbiBvbiB5b3VyIG1pcnJvciwKY2hlY2sgJChob3N0bmFtZSAtcyk6JHtUT30vcHJvamVjdC9mdHBzeW5jL2Z0cHN5bmMtJHtMQVRFU1R9LnRhci5negoKWW91IGNhbiBlbnN1cmUgdGhlIHZhbGlkaXR5IG9mIHRoYXQgZmlsZSBieSB1c2luZyBzaGE1MTJzdW0gb3IgbWQ1c3VtCmFnYWluc3QgdGhlIGF2YWlsYWJsZSBjaGVja3N1bSBmaWxlcyBzZWN1cmVkIHdpdGggYSBzaWduYXR1cmUgZnJvbSB0aGUKRGViaWFuIEZUUE1hc3RlciBzaWduaW5nIGtleS4KCiIgJHtNQUlMVE99CgogICAgICAgICAgICAgICAgICAgIGRhdGUgKyVzID4gIiR7TE9HRElSfS9mdHBzeW5jLm5ld3ZlcnNpb24iCiAgICAgICAgICAgICAgICBmaQogICAgICAgICAgICBmaQogICAgICAgIGVsc2UKICAgICAgICAgICAgIyBSZW1vdmUgYSBwb3NzaWJsZSBzdGFtcGZpbGUKICAgICAgICAgICAgcm0gLWYgIiR7TE9HRElSfS9mdHBzeW5jLm5ld3ZlcnNpb24iCiAgICAgICAgZmkKICAgIGZpCn0KCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKIyMgZnVuY3Rpb25zICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMjCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKY2hlY2tfY29tbWFuZGxpbmUoKSB7CiAgICB3aGlsZSBbWyAkIyAtZ3QgMCBdXTsgZG8KICAgICAgICBjYXNlICIkMSIgaW4KICAgICAgICAgICAgc3luYzpzdGFnZTEpCiAgICAgICAgICAgICAgICBTWU5DU1RBR0UxPSJ0cnVlIgogICAgICAgICAgICAgICAgU1lOQ0FMTD0iZmFsc2UiCiAgICAgICAgICAgICAgICA7OwogICAgICAgICAgICBzeW5jOnN0YWdlMikKICAgICAgICAgICAgICAgIFNZTkNTVEFHRTI9InRydWUiCiAgICAgICAgICAgICAgICBTWU5DQUxMPSJmYWxzZSIKICAgICAgICAgICAgICAgIDs7CiAgICAgICAgICAgIHN5bmM6Y2FsbGJhY2spCiAgICAgICAgICAgICAgICBTWU5DQ0FMTEJBQ0s9InRydWUiCiAgICAgICAgICAgICAgICA7OwogICAgICAgICAgICBzeW5jOmFyY2hpdmU6KikKICAgICAgICAgICAgICAgIEFSQ0hJVkU9JHsxIyNzeW5jOmFyY2hpdmU6fQogICAgICAgICAgICAgICAgOzsKICAgICAgICAgICAgc3luYzphbGwpCiAgICAgICAgICAgICAgICBTWU5DQUxMPSJ0cnVlIgogICAgICAgICAgICAgICAgOzsKICAgICAgICAgICAgc3luYzptaG9wKQogICAgICAgICAgICAgICAgU1lOQ01IT1A9InRydWUiCiAgICAgICAgICAgICAgICA7OwogICAgICAgICAgICAqKQogICAgICAgICAgICAgICAgZWNobyAiVW5rbm93biBvcHRpb24gJHsxfSBpZ25vcmVkIgogICAgICAgICAgICAgICAgOzsKICAgICAgICBlc2FjCiAgICAgICAgc2hpZnQgICMgQ2hlY2sgbmV4dCBzZXQgb2YgcGFyYW1ldGVycy4KICAgIGRvbmUKfQoKIyBBbGwgdGhlIHN0dWZmIHdlIHdhbnQgdG8gZG8gd2hlbiB3ZSBleGl0LCBubyBtYXR0ZXIgd2hlcmUKY2xlYW51cCgpIHsKICAgIHJjPSQ/CgogICAgdHJhcCAtIEVSUiBURVJNIEhVUCBJTlQgUVVJVCBFWElUCiAgICAjIGFsbCBkb25lLiBNYWlsIHRoZSBsb2csIGV4aXQuCgogICAgaWYgW1sgJHJjIC1ndCAwIF1dOyB0aGVuCiAgICAgICAgbG9nICJNaXJyb3JzeW5jIGRvbmUgd2l0aCBlcnJvcnMiCiAgICBlbHNlCiAgICAgICAgbG9nICJNaXJyb3JzeW5jIGRvbmUiCiAgICBmaQoKICAgIGlmIFtbIC1uICR7TUFJTFRPfSBdXTsgdGhlbgogICAgICAgIGxvY2FsIGFyZ3M9KCkKICAgICAgICBsb2NhbCBzZW5kPQogICAgICAgIGxvY2FsIHN1YmplY3Q9IlNVQ0NFU1MiCgogICAgICAgICMgSW4gY2FzZSByc3luYyBoYWQgc29tZXRoaW5nIG9uIHN0ZGVycgogICAgICAgIGlmIFtbIC1zICRMT0dfUlNZTkNfRVJST1IgXV07IHRoZW4KICAgICAgICAgICAgYXJncys9KC1hICRMT0dfUlNZTkNfRVJST1IgLWEgJExPRykKICAgICAgICAgICAgc3ViamVjdD0iRVJST1I6IHJzeW5jIGVycm9ycyIKICAgICAgICAgICAgc2VuZD0xCiAgICAgICAgIyBJbiBjYXNlIG9mIGRpcmVjdCBlcnJvcnMKICAgICAgICBlbGlmIFtbICRyYyAtZ3QgMCBdXTsgdGhlbgogICAgICAgICAgICBhcmdzKz0oLWEgJExPRykKICAgICAgICAgICAgc3ViamVjdD0iRVJST1IiCiAgICAgICAgICAgIHNlbmQ9MQogICAgICAgICMgSW4gY2FzZSBhZG1pbiB3YW50IGFsbCBsb2dzCiAgICAgICAgZWxpZiBbWyAke0VSUk9SU09OTFl9ID0gZmFsc2UgXV07IHRoZW4KICAgICAgICAgICAgYXJncys9KC1hICRMT0cpCiAgICAgICAgICAgIGlmIFtbICR7TE9HX0VSUk9SOi19IF1dOyB0aGVuCiAgICAgICAgICAgICAgICBzdWJqZWN0PSJFUlJPUiIKICAgICAgICAgICAgZmkKICAgICAgICAgICAgc2VuZD0xCiAgICAgICAgZmkKICAgICAgICBpZiBbWyAkc2VuZCBdXTsgdGhlbgogICAgICAgICAgICAjIFNvbWVvbmUgd2FudHMgZnVsbCBsb2dzIGluY2x1ZGluZyByc3luYwogICAgICAgICAgICBpZiBbWyAke0ZVTExMT0dTfSA9IHRydWUgXV07IHRoZW4KICAgICAgICAgICAgICAgIGFyZ3MrPSgtYSAkTE9HX1JTWU5DKQogICAgICAgICAgICBmaQogICAgICAgICAgICBtYWlsZiAiJHthcmdzW0BdfSIgLXMgIlske1BST0dSQU19QCQoaG9zdG5hbWUgLXMpXSAke3N1YmplY3R9IiAke01BSUxUT30KICAgICAgICBmaQogICAgZmkKCiAgICBzYXZlbG9nICIke0xPR19SU1lOQ30iCiAgICBzYXZlbG9nICIke0xPR19SU1lOQ19FUlJPUn0iCiAgICBzYXZlbG9nICIkTE9HIiA+IC9kZXYvbnVsbAoKICAgIHJtIC1mICIke0xPQ0t9IgoKICAgIGV4aXQgJHJjCn0KCnJ1bl9yc3luYygpIHsKICBsb2NhbCB0PSQxCiAgc2hpZnQKCiAgbG9nICJSdW5uaW5nICR0OiIgIiR7X1JTWU5DW0BdfSIgIiRAIgoKICAiJHtfUlNZTkNbQF19IiAiJEAiIFwKICAgID4+IiR7TE9HX1JTWU5DX0VSUk9SfSIgMj4mMSB8fCByZXR1cm4gJD8KfQoKIyBDaGVjayByc3luY3MgcmV0dXJuIHZhbHVlCmNoZWNrX3JzeW5jKCkgewogICAgcmV0PSQxCiAgICBtc2c9JDIKCiAgICAjIExldHMgZ2V0IGEgc3RhdGlzdGljYWwgdmFsdWUKICAgIGlmIFtbIC1mICR7TE9HX1JTWU5DfSBdXTsgdGhlbgogICAgICAgIFNQRUVEPSQodGFpbCAtbiAyICR7TE9HX1JTWU5DfSB8IHNlZCAtRW5lICdzIy4qIChbMC05LixdKykgYnl0ZXMvc2VjI1wxI3AnKQogICAgICAgIGlmIFtbICR7U1BFRUR9IF1dOyB0aGVuCiAgICAgICAgICAgIFNQRUVEPSR7U1BFRUQlJS4qfQogICAgICAgICAgICBTUEVFRD0ke1NQRUVELy8sfQogICAgICAgICAgICBTUEVFRD0kKCggU1BFRUQgLyAxMDI0ICkpCiAgICAgICAgICAgIGxvZyAiTGF0ZXN0IHJlY29yZGVkIHJzeW5jIHRyYW5zZmVyIHNwZWVkOiAke1NQRUVEfSBLQi9zIgogICAgICAgIGZpCiAgICBmaQoKICAgICMgMjQgLSB2YW5pc2hlZCBzb3VyY2UgZmlsZXMuIElnbm9yZWQsIHRoYXQgc2hvdWxkIGJlIHRoZSB0YXJnZXQgb2YgJFVQREFURVJFUVVJUkVECiAgICAjIGFuZCB1cyByZS1ydW5uaW5nLiBJZiBpdCdzIG5vdCwgdXBsaW5rIGlzIGJyb2tlbiBhbnl3YXlzLgogICAgY2FzZSAiJHtyZXR9IiBpbgogICAgICAgIDApIHJldHVybiAwOzsKICAgICAgICAyNCkgcmV0dXJuIDA7OwogICAgICAgIDIzKSByZXR1cm4gMjs7CiAgICAgICAgMzApIHJldHVybiAyOzsKICAgICAgICAqKQogICAgICAgICAgICBlcnJvciAiRVJST1I6ICR7bXNnfSIKICAgICAgICAgICAgcmV0dXJuIDEKICAgICAgICAgICAgOzsKICAgIGVzYWMKfQoKZnVuY3Rpb24gdHJhY2VmaWxlX2NvbnRlbnQoKSB7CiAgICBzZXQgK2UKCiAgICBMQ19BTEw9UE9TSVggTEFORz1QT1NJWCBkYXRlIC11CiAgICByZmM4MjJkYXRlPSQoTENfQUxMPVBPU0lYIExBTkc9UE9TSVggZGF0ZSAtdSAtUikKICAgIGVjaG8gIkRhdGU6ICR7cmZjODIyZGF0ZX0iCiAgICBlY2hvICJEYXRlLVN0YXJ0ZWQ6ICR7REFURV9TVEFSVEVEfSIKCiAgICBpZiBbWyAtZSAkVFJBQ0VGSUxFX01BU1RFUiBdXTsgdGhlbgogICAgICAgIGVjaG8gIkFyY2hpdmUgc2VyaWFsOiAkKGV4dHJhY3RfdHJhY2Vfc2VyaWFsICRUUkFDRUZJTEVfTUFTVEVSIHx8IGVjaG8gdW5rbm93biApIgogICAgZmkKCiAgICBlY2hvICJVc2VkIGZ0cHN5bmMgdmVyc2lvbjogJHtWRVJTSU9OfSIKICAgIGVjaG8gIkNyZWF0b3I6IGZ0cHN5bmMgJHtWRVJTSU9OfSIKICAgIGVjaG8gIlJ1bm5pbmcgb24gaG9zdDogJHtUUkFDRUhPU1R9IgoKICAgIGlmIFtbICR7SU5GT19NQUlOVEFJTkVSOi19IF1dOyB0aGVuCiAgICAgICAgZWNobyAiTWFpbnRhaW5lcjogJHtJTkZPX01BSU5UQUlORVJ9IgogICAgZmkKICAgIGlmIFtbICR7SU5GT19TUE9OU09SOi19IF1dOyB0aGVuCiAgICAgICAgZWNobyAiU3BvbnNvcjogJHtJTkZPX1NQT05TT1J9IgogICAgZmkKICAgIGlmIFtbICR7SU5GT19DT1VOVFJZOi19IF1dOyB0aGVuCiAgICAgICAgZWNobyAiQ291bnRyeTogJHtJTkZPX0NPVU5UUll9IgogICAgZmkKICAgIGlmIFtbICR7SU5GT19MT0NBVElPTjotfSBdXTsgdGhlbgogICAgICAgIGVjaG8gIkxvY2F0aW9uOiAke0lORk9fTE9DQVRJT059IgogICAgZmkKICAgIGlmIFtbICR7SU5GT19USFJPVUdIUFVUOi19IF1dOyB0aGVuCiAgICAgICAgZWNobyAiVGhyb3VnaHB1dDogJHtJTkZPX1RIUk9VR0hQVVR9IgogICAgZmkKICAgIGlmIFtbICR7SU5GT19UUklHR0VSOi19IF1dOyB0aGVuCiAgICAgICAgZWNobyAiVHJpZ2dlcjogJHtJTkZPX1RSSUdHRVJ9IgogICAgZmkKCiAgICBpZiBbWyAtZCAke1RPfS9kaXN0cyBdXTsgdGhlbgogICAgICAgIEFSQ0g9JChmaW5kICR7VE99L2Rpc3RzIFwoIC1uYW1lICdQYWNrYWdlcy4qJyAtbyAtbmFtZSAnU291cmNlcy4qJyBcKSAyPi9kZXYvbnVsbCB8CiAgICAgICAgICAgIHNlZCAtRW5lICdzIy4qL2JpbmFyeS0oW14vXSspL1BhY2thZ2VzLiojXDEjcDsgcyMuKi8oc291cmNlKS9Tb3VyY2VzLiojXDEjcCcgfAogICAgICAgICAgICBzb3J0IC11IHwgdHIgJ1xuJyAnICcpCiAgICAgICAgaWYgW1sgJEFSQ0ggXV07IHRoZW4KICAgICAgICAgICAgZWNobyAiQXJjaGl0ZWN0dXJlczogJHtBUkNIfSIKICAgICAgICBmaQogICAgZmkKICAgIGlmIFtbICR7QVJDSF9JTkNMVURFfSBdXTsgdGhlbgogICAgICAgIGVjaG8gIkFyY2hpdGVjdHVyZXMtQ29uZmlndXJhdGlvbjogSU5DTFVERSAkKHRyICcgJyAnXG4nIDw8PCAke0FSQ0hfSU5DTFVERX0gfCBzb3J0IC11IHwgdHIgJ1xuJyAnICcpIgogICAgZWxpZiBbWyAke0FSQ0hfRVhDTFVERX0gXV07IHRoZW4KICAgICAgICBlY2hvICJBcmNoaXRlY3R1cmVzLUNvbmZpZ3VyYXRpb246IEVYQ0xVREUgJCh0ciAnICcgJ1xuJyA8PDwgJHtBUkNIX0VYQ0xVREV9IHwgc29ydCAtdSB8IHRyICdcbicgJyAnKSIKICAgIGVsc2UKICAgICAgICBlY2hvICJBcmNoaXRlY3R1cmVzLUNvbmZpZ3VyYXRpb246IEFMTCIKICAgIGZpCiAgICBlY2hvICJVcHN0cmVhbS1taXJyb3I6ICR7UlNZTkNfSE9TVDotdW5rbm93bn0iCiAgICBlY2hvICJSc3luYy1UcmFuc3BvcnQ6ICR7UlNZTkNfVFJBTlNQT1JUfSIKICAgIHRvdGFsPTAKICAgIGlmIFtbIC1lICR7TE9HX1JTWU5DfSBdXTsgdGhlbgogICAgICAgIGZvciBieXRlcyBpbiAkKHNlZCAtRW5lICdzLyhefC4qIClzZW50IChbMC05XSspIGJ5dGVzICByZWNlaXZlZCAoWzAtOV0rKSBieXRlcy4qL1wzL3AnICIke0xPR19SU1lOQ30iKTsgZG8KICAgICAgICAgICAgdG90YWw9JCgoIHRvdGFsICsgYnl0ZXMgKSkKICAgICAgICBkb25lCiAgICAgICAgaWYgW1sgJHRvdGFsIC1ndCAwIF1dOyB0aGVuCiAgICAgICAgICAgIGVjaG8gIlRvdGFsIGJ5dGVzIHJlY2VpdmVkIGluIHJzeW5jOiAke3RvdGFsfSIKICAgICAgICBmaQogICAgZmkKICAgIHRvdGFsX3RpbWU9JCgoIFNUQVRTX1RPVEFMX1JTWU5DX1RJTUUxICsgU1RBVFNfVE9UQUxfUlNZTkNfVElNRTIgKSkKICAgIGVjaG8gIlRvdGFsIHRpbWUgc3BlbnQgaW4gc3RhZ2UxIHJzeW5jOiAke1NUQVRTX1RPVEFMX1JTWU5DX1RJTUUxfSIKICAgIGVjaG8gIlRvdGFsIHRpbWUgc3BlbnQgaW4gc3RhZ2UyIHJzeW5jOiAke1NUQVRTX1RPVEFMX1JTWU5DX1RJTUUyfSIKICAgIGVjaG8gIlRvdGFsIHRpbWUgc3BlbnQgaW4gcnN5bmM6ICR7dG90YWxfdGltZX0iCiAgICBpZiBbWyAwICE9ICR7dG90YWxfdGltZX0gXV07IHRoZW4KICAgICAgICByYXRlPSQoKCB0b3RhbCAvIHRvdGFsX3RpbWUgKSkKICAgICAgICBlY2hvICJBdmVyYWdlIHJhdGU6ICR7cmF0ZX0gQi9zIgogICAgZmkKCiAgICBzZXQgLWUKfQoKIyBXcml0ZSBhIHRyYWNlZmlsZQp0cmFjZWZpbGUoKSB7CiAgICBsb2NhbCBUUkFDRUZJTEU9JHsxOi0iJHtUT30vJHtUUkFDRX0ifQogICAgbG9jYWwgVFJBQ0VGSUxFX01BU1RFUj0iJHtUT30vJHtUUkFDRURJUn0vbWFzdGVyIgoKICAgIHRyYWNlZmlsZV9jb250ZW50ID4gIiR7VFJBQ0VGSUxFfS5uZXciCiAgICBtdiAiJHtUUkFDRUZJTEV9Lm5ldyIgIiR7VFJBQ0VGSUxFfSIKCiAgICB7CiAgICAgICAgaWYgW1sgLWUgJHtUT30vJHtUUkFDRUhJRVJBUkNIWX0ubWlycm9yIF1dOyB0aGVuCiAgICAgICAgICAgIGNhdCAke1RPfS8ke1RSQUNFSElFUkFSQ0hZfS5taXJyb3IKICAgICAgICBmaQogICAgICAgIGVjaG8gIiQoYmFzZW5hbWUgIiR7VFJBQ0VGSUxFfSIpICR7TUlSUk9STkFNRX0gJHtUUkFDRUhPU1R9ICR7UlNZTkNfSE9TVDotdW5rbm93bn0iCiAgICB9ID4gIiR7VE99LyR7VFJBQ0VISUVSQVJDSFl9Ii5uZXcKICAgIG12ICIke1RPfS8ke1RSQUNFSElFUkFSQ0hZfSIubmV3ICIke1RPfS8ke1RSQUNFSElFUkFSQ0hZfSIKICAgIGNwICIke1RPfS8ke1RSQUNFSElFUkFSQ0hZfSIgIiR7VE99LyR7VFJBQ0VISUVSQVJDSFl9Lm1pcnJvciIKCiAgICAoY2QgIiR7VE99LyR7VFJBQ0VESVJ9IiAmJiBscyAtMXJ0ICQoZmluZCAqIC10eXBlIGYgXCEgLW5hbWUgIl8qIikpID4gIiR7VE99LyR7VFJBQ0VMSVNUfSIKfQoKYXJjaF9pbWV4Y2x1ZGUoKSB7CiAgICBsb2NhbCBwYXJhbT0iJDEiIGFyY2g9IiQyIgogICAgaWYgW1sgJGFyY2ggPSBzb3VyY2UgXV07IHRoZW4KICAgICAgICBfUlNZTkMrPSgKICAgICAgICAgICAgIi0tZmlsdGVyPSR7cGFyYW19Xy9kaXN0cy8qKi9zb3VyY2UvIgogICAgICAgICAgICAiLS1maWx0ZXI9JHtwYXJhbX1fL3Bvb2wvKiovKi50YXIuKiIKICAgICAgICAgICAgIi0tZmlsdGVyPSR7cGFyYW19Xy9wb29sLyoqLyouZGlmZi4qIgogICAgICAgICAgICAiLS1maWx0ZXI9JHtwYXJhbX1fL3Bvb2wvKiovKi5kc2MiCiAgICAgICAgKQogICAgZWxzZQogICAgICAgIF9SU1lOQys9KAogICAgICAgICAgICAiLS1maWx0ZXI9JHtwYXJhbX1fL2Rpc3RzLyoqL2JpbmFyeS0ke2FyY2h9LyIKICAgICAgICAgICAgIi0tZmlsdGVyPSR7cGFyYW19Xy9kaXN0cy8qKi9pbnN0YWxsZXItJHthcmNofS8iCiAgICAgICAgICAgICItLWZpbHRlcj0ke3BhcmFtfV8vZGlzdHMvKiovQ29udGVudHMtJHthcmNofS5neiIKICAgICAgICAgICAgIi0tZmlsdGVyPSR7cGFyYW19Xy9kaXN0cy8qKi9Db250ZW50cy11ZGViLSR7YXJjaH0uZ3oiCiAgICAgICAgICAgICItLWZpbHRlcj0ke3BhcmFtfV8vZGlzdHMvKiovQ29udGVudHMtJHthcmNofS5kaWZmLyIKICAgICAgICAgICAgIi0tZmlsdGVyPSR7cGFyYW19Xy9pbmRpY2VzLyoqL2FyY2gtJHthcmNofS5maWxlcyIKICAgICAgICAgICAgIi0tZmlsdGVyPSR7cGFyYW19Xy9pbmRpY2VzLyoqL2FyY2gtJHthcmNofS5saXN0Lmd6IgogICAgICAgICAgICAiLS1maWx0ZXI9JHtwYXJhbX1fL3Bvb2wvKiovKl8ke2FyY2h9LmRlYiIKICAgICAgICAgICAgIi0tZmlsdGVyPSR7cGFyYW19Xy9wb29sLyoqLypfJHthcmNofS51ZGViIgogICAgICAgICAgICAiLS1maWx0ZXI9JHtwYXJhbX1fL3Bvb2wvKiovKl8ke2FyY2h9LmNoYW5nZXMiCiAgICAgICAgKQogICAgZmkKfQoKYXJjaF9leGNsdWRlKCkgewogICAgYXJjaF9pbWV4Y2x1ZGUgZXhjbHVkZSAiJDEiCn0KCmFyY2hfaW5jbHVkZSgpIHsKICAgIGFyY2hfaW1leGNsdWRlIGluY2x1ZGUgIiQxIgp9CgojIExlYXJuIHdoaWNoIGFyY2hzIHRvIGluY2x1ZGUvZXhjbHVkZSBiYXNlZCBvbiBBUkNIX0VYQ0xVREUgYW5kIEFSQ0hfSU5DTFVERQojIHNldHRpbmdzLgojIFNldHMgRVhDTFVERSAod2hpY2ggbWlnaHQgYWxzbyBoYXZlIC0taW5jbHVkZSBzdGF0ZW1lbnRzCiMgZm9sbG93ZWQgYnkgYSAtLWV4Y2x1ZGUgKl8qLjx0aGluZ3M+LgpzZXRfZXhjbHVkZV9pbmNsdWRlX2FyY2hzKCkgewogICAgaWYgW1sgLW4gIiR7QVJDSF9FWENMVURFfSIgXV0gJiYgW1sgLW4gIiR7QVJDSF9JTkNMVURFfSIgXV07IHRoZW4KICAgICAgICBlY2hvID4mMiAiQVJDSF9FWENMVURFIGFuZCBBUkNIX0lOQ0xVREUgYXJlIG11dHVhbGx5IGV4Y2x1c2l2ZS4gIFNldCBvbmx5IG9uZS4iCiAgICAgICAgZXhpdCAxCiAgICBmaQoKICAgIGlmIFtbIC1uICIke0FSQ0hfRVhDTFVERX0iIF1dOyB0aGVuCiAgICAgICAgZm9yIEFSQ0ggaW4gJHtBUkNIX0VYQ0xVREV9OyBkbwogICAgICAgICAgICBhcmNoX2V4Y2x1ZGUgJHtBUkNIfQogICAgICAgIGRvbmUKICAgICAgICBhcmNoX2luY2x1ZGUgJyonCiAgICAgICAgYXJjaF9pbmNsdWRlIHNvdXJjZQogICAgZWxpZiBbWyAtbiAiJHtBUkNIX0lOQ0xVREV9IiBdXTsgdGhlbgogICAgICAgIGxvY2FsIGluY2x1ZGVfYXJjaF9hbGw9ZmFsc2UKICAgICAgICBmb3IgQVJDSCBpbiAke0FSQ0hfSU5DTFVERX07IGRvCiAgICAgICAgICAgIGFyY2hfaW5jbHVkZSAke0FSQ0h9CiAgICAgICAgICAgIGlmIFtbICR7QVJDSH0gIT0gc291cmNlIF1dOyB0aGVuCiAgICAgICAgICAgICAgICBpbmNsdWRlX2FyY2hfYWxsPXRydWUKICAgICAgICAgICAgZmkKICAgICAgICBkb25lCiAgICAgICAgaWYgW1sgdHJ1ZSA9ICR7aW5jbHVkZV9hcmNoX2FsbH0gXV07IHRoZW4KICAgICAgICAgICAgYXJjaF9pbmNsdWRlIGFsbAogICAgICAgIGZpCiAgICAgICAgYXJjaF9leGNsdWRlICcqJwogICAgICAgIGFyY2hfZXhjbHVkZSBzb3VyY2UKICAgIGZpCn0KCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKCgojIEFzIHdoYXQgYXJlIHdlIGNhbGxlZD8KTkFNRT0iJChiYXNlbmFtZSAkMCkiCgojIFdoYXQgc2hvdWxkIHdlIGRvPwpBUkNISVZFPQojIERvIHdlIHN5bmMgc3RhZ2UxPwpTWU5DU1RBR0UxPWZhbHNlCiMgRG8gd2Ugc3luYyBzdGFnZTI/ClNZTkNTVEFHRTI9ZmFsc2UKIyBEbyB3ZSBzeW5jIGFsbD8KU1lOQ0FMTD10cnVlCiMgRG8gd2UgaGF2ZSBhIG1ob3Agc3luYz8KU1lOQ01IT1A9ZmFsc2UKIyBEbyB3ZSBjYWxsYmFjaz8gKE1heSBnZXQgY2hhbmdlZCBsYXRlcikKU1lOQ0NBTExCQUNLPWZhbHNlCgp3aGlsZSBnZXRvcHRzIFQ6IG9wdGlvbjsgZG8KICAgIGNhc2UgJG9wdGlvbiBpbgogICAgICAgIFQpIElORk9fVFJJR0dFUj0kT1BUQVJHOzsKICAgICAgICA/KSBleGl0IDY0OzsKICAgIGVzYWMKZG9uZQpzaGlmdCAkKCgkT1BUSU5EIC0gMSkpCgojIE5vdywgY2hlY2sgaWYgd2UgZ290IHRvbGQgYWJvdXQgc3R1ZmYgdmlhIHNzaAppZiBbWyAtbiAke1NTSF9PUklHSU5BTF9DT01NQU5EOi19IF1dOyB0aGVuCiAgICBJTkZPX1RSSUdHRVI9JHtJTkZPX1RSSUdHRVI6LXNzaH0KICAgIGNoZWNrX2NvbW1hbmRsaW5lICR7U1NIX09SSUdJTkFMX0NPTU1BTkR9CmZpCgojIE5vdywgd2UgY2FuIGxvY2FsbHkgb3ZlcnJpZGUgYWxsIHRoZSBhYm92ZSB2YXJpYWJsZXMgYnkganVzdCBwdXR0aW5nCiMgdGhlbSBpbnRvIHRoZSAuc3NoL2F1dGhvcml6ZWRfa2V5cyBmaWxlIGZvcmNlZCBjb21tYW5kLgppZiBbWyAkIyAtZ3QgMCBdXTsgdGhlbgogICAgY2hlY2tfY29tbWFuZGxpbmUgIiRAIgpmaQoKIyBJZiB3ZSBoYXZlIGJlZW4gdG9sZCB0byBkbyBzdHVmZiBmb3IgYSBkaWZmZXJlbnQgYXJjaGl2ZSB0aGFuIGRlZmF1bHQsCiMgc2V0IHRoZSBuYW1lIGFjY29yZGluZ2x5LgppZiBbWyAtbiAke0FSQ0hJVkV9IF1dOyB0aGVuCiAgICBOQU1FPSIke05BTUV9LSR7QVJDSElWRX0iCmZpCgojIE5vdyBzb3VyY2UgdGhlIGNvbmZpZyBmb3IgdGhlIGFyY2hpdmUgd2UgcnVuIG9uLgojIChZZXMsIHBlb3BsZSBjYW4gYWxzbyBvdmVyd3JpdGUgdGhlIG9wdGlvbnMgYWJvdmUgaW4gdGhlIGNvbmZpZyBmaWxlCiMgaWYgdGhleSB3YW50IHRvKQpyZWFkX2NvbmZpZyAiJHtOQU1FfS5jb25mIgoKY3JlYXRlX2xvZ2RpcgoKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiMgQ29uZmlnIGRlZmF1bHRzICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIwojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKTUlSUk9STkFNRT0ke01JUlJPUk5BTUU6LSQoaG9zdG5hbWUgLWYpfQpUTz0ke1RPOi0iL3Nydi9taXJyb3JzL2RlYmlhbi8ifQpNQUlMVE89JHtNQUlMVE86LSR7TE9HTkFNRTo/RW52aXJvbm1lbnQgdmFyaWFibGUgTE9HTkFNRSB1bnNldCwgcGxlYXNlIGNoZWNrIHlvdXIgc3lzdGVtIG9yIHNwZWNpZnkgTUFJTFRPfX0KSFVCPSR7SFVCOi0iZmFsc2UifQoKIyBDb25uZWN0aW9uIG9wdGlvbnMKaWYgW1sgLXogJHtSU1lOQ19TT1VSQ0U6LX0gXV07IHRoZW4KICAgIFJTWU5DX0hPU1Q9JHtSU1lOQ19IT1NUOj9NaXNzaW5nIGEgaG9zdCB0byBtaXJyb3IgZnJvbSwgcGxlYXNlIHNldCBSU1lOQ19IT1NUIHZhcmlhYmxlIGluICR7Q1VSUkVOVF9DT05GSUd9fQogICAgUlNZTkNfUEFUSD0ke1JTWU5DX1BBVEg6LSJkZWJpYW4ifQogICAgUlNZTkNfVVNFUj0ke1JTWU5DX1VTRVI6LSIifQpmaQpSU1lOQ19QQVNTV09SRD0ke1JTWU5DX1BBU1NXT1JEOi0iIn0KaWYgW1sgJHtSU1lOQ19TU0w6LX0gPSB0cnVlIF1dOyB0aGVuCiAgICBSU1lOQ19UUkFOU1BPUlQ9JHtSU1lOQ19UUkFOU1BPUlQ6LSJzc2wifQplbHNlCiAgICBSU1lOQ19UUkFOU1BPUlQ9JHtSU1lOQ19UUkFOU1BPUlQ6LSJ1bmRlZmluZWQifQpmaQpSU1lOQ19TU0xfUE9SVD0ke1JTWU5DX1NTTF9QT1JUOi0iMTg3MyJ9ClJTWU5DX1NTTF9DQVBBVEg9JHtSU1lOQ19TU0xfQ0FQQVRIOi0iL2V0Yy9zc2wvY2VydHMifQpSU1lOQ19TU0xfTUVUSE9EPSR7UlNZTkNfU1NMX01FVEhPRDotInN0dW5uZWwifQpSU1lOQ19QUk9YWT0ke1JTWU5DX1BST1hZOi0iIn0KCiMgSW5jbHVkZSBhbmQgZXhjbHVkZSBvcHRpb25zCkFSQ0hfSU5DTFVERT0ke0FSQ0hfSU5DTFVERTotIiJ9CkFSQ0hfRVhDTFVERT0ke0FSQ0hfRVhDTFVERTotIiJ9CkVYQ0xVREU9JHtFWENMVURFOi0iIn0KCiMgTG9nIG9wdGlvbnMKTE9HPSR7TE9HOi0iJHtMT0dESVJ9LyR7TkFNRX0ubG9nIn0KRVJST1JTT05MWT0ke0VSUk9SU09OTFk6LSJ0cnVlIn0KRlVMTExPR1M9JHtGVUxMTE9HUzotImZhbHNlIn0KTE9HUk9UQVRFPSR7TE9HUk9UQVRFOi0xNH0KTE9HX1JTWU5DPSIke0xPR0RJUn0vcnN5bmMtJHtOQU1FfS5sb2ciCkxPR19SU1lOQ19FUlJPUj0iJHtMT0dESVJ9L3JzeW5jLSR7TkFNRX0uZXJyb3IiCgojIE90aGVyIG9wdGlvbnMKTE9DS1RJTUVPVVQ9JHtMT0NLVElNRU9VVDotMzYwMH0KVUlQU0xFRVA9JHtVSVBTTEVFUDotMTIwMH0KVUlQUkVUUklFUz0ke1VJUFJFVFJJRVM6LTN9ClRSQUNFSE9TVD0ke1RSQUNFSE9TVDotJChob3N0bmFtZSAtZil9ClJTWU5DPSR7UlNZTkM6LXJzeW5jfQpSU1lOQ19QUk9UT0NPTD0kKHJzeW5jX3Byb3RvY29sKQpSU1lOQ19FWFRSQT0ke1JTWU5DX0VYVFJBOi0iIn0KUlNZTkNfQlc9JHtSU1lOQ19CVzotMH0KaWYgW1sgJFJTWU5DX1BST1RPQ09MIC1nZSAzMSBdXTsgdGhlbgogICAgUlNZTkNfT1BUSU9OUz0ke1JTWU5DX09QVElPTlM6LSItcHJsdHZIU0I4MTkyIC0tc2FmZS1saW5rcyAtLWNobW9kPUQ3NTUsRjY0NCAtLXRpbWVvdXQgMTIwIC0tc3RhdHMgLS1uby1odW1hbi1yZWFkYWJsZSAtLW5vLWluYy1yZWN1cnNpdmUifQplbHNlCiAgICBSU1lOQ19PUFRJT05TPSR7UlNZTkNfT1BUSU9OUzotIi1wcmx0dkhTQjgxOTIgLS1zYWZlLWxpbmtzIC0tdGltZW91dCAxMjAgLS1zdGF0cyAtLW5vLWh1bWFuLXJlYWRhYmxlIC0tbm8taW5jLXJlY3Vyc2l2ZSJ9CmZpClJTWU5DX09QVElPTlMxPSR7UlNZTkNfT1BUSU9OUzE6LSItLWluY2x1ZGU9Ki5kaWZmLyAtLWV4Y2x1ZGU9Ki5kaWZmL0luZGV4IC0tZXhjbHVkZT1QYWNrYWdlcyogLS1leGNsdWRlPVNvdXJjZXMqIC0tZXhjbHVkZT1SZWxlYXNlKiAtLWV4Y2x1ZGU9SW5SZWxlYXNlIC0taW5jbHVkZT1pMThuL2J5LWhhc2ggLS1leGNsdWRlPWkxOG4vKiAtLWV4Y2x1ZGU9bHMtbFIqIn0KUlNZTkNfT1BUSU9OUzI9JHtSU1lOQ19PUFRJT05TMjotIi0tbWF4LWRlbGV0ZT00MDAwMCAtLWRlbGF5LXVwZGF0ZXMgLS1kZWxldGUgLS1kZWxldGUtZGVsYXkgLS1kZWxldGUtZXhjbHVkZWQifQpDQUxMQkFDS1VTRVI9JHtDQUxMQkFDS1VTRVI6LSJhcmNodnN5bmMifQpDQUxMQkFDS0hPU1Q9JHtDQUxMQkFDS0hPU1Q6LSJub25lIn0KQ0FMTEJBQ0tLRVk9JHtDQUxMQkFDS0tFWTotIm5vbmUifQoKIyBIb29rcwpIT09LMT0ke0hPT0sxOi0iIn0KSE9PSzI9JHtIT09LMjotIiJ9CkhPT0szPSR7SE9PSzM6LSIifQpIT09LND0ke0hPT0s0Oi0iIn0KSE9PSzU9JHtIT09LNTotIiJ9CiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKCiMgdXNlZCBieSBsb2coKSBhbmQgZXJyb3IoKQpQUk9HUkFNPSR7UFJPR1JBTTotIiR7TkFNRX0ifQoKIyBPdXIgdHJhY2UgYW5kIGxvY2sgZmlsZXMKTE9DS19OQU1FPSJBcmNoaXZlLVVwZGF0ZS1pbi1Qcm9ncmVzcy0ke01JUlJPUk5BTUV9IgpMT0NLPSIke1RPfS8ke0xPQ0tfTkFNRX0iClVQREFURVJFUVVJUkVEX05BTUU9IkFyY2hpdmUtVXBkYXRlLVJlcXVpcmVkLSR7TUlSUk9STkFNRX0iClVQREFURVJFUVVJUkVEPSIke1RPfS8ke1VQREFURVJFUVVJUkVEX05BTUV9IgpUUkFDRURJUj1wcm9qZWN0L3RyYWNlClRSQUNFPSIke1RSQUNFRElSfS8ke01JUlJPUk5BTUV9IgpUUkFDRV9TVEFHRTE9IiR7VFJBQ0VESVJ9LyR7TUlSUk9STkFNRX0tc3RhZ2UxIgpUUkFDRUhJRVJBUkNIWT0iJHtUUkFDRURJUn0vX2hpZXJhcmNoeSIKVFJBQ0VMSVNUPSIke1RSQUNFRElSfS9fdHJhY2VzIgoKX1RSQUNFX0ZJTEVTPSgKICAiJHtMT0NLX05BTUV9IgogICIke1VQREFURVJFUVVJUkVEX05BTUV9IgogICIke1RSQUNFfSIKICAiJHtUUkFDRV9TVEFHRTF9IgogICIke1RSQUNFSElFUkFSQ0hZfSIKICAiJHtUUkFDRUxJU1R9IgopCgpfUlNZTkM9KAogICRSU1lOQwogIC0tcXVpZXQKICAtLWxvZy1maWxlICIke0xPR19SU1lOQ30iCikKCiMgUnN5bmMgZmlsdGVyIHJ1bGVzLiBVc2VkIHRvIHByb3RlY3QgdmFyaW91cyBmaWxlcyB3ZSBhbHdheXMgd2FudCB0byBrZWVwLCBldmVuIGlmIHdlIG90aGVyd2lzZSBkZWxldGUKIyBleGNsdWRlZCBmaWxlcwpmb3IgaSBpbiAke19UUkFDRV9GSUxFU1tAXX07IGRvCiAgX1JTWU5DKz0oIi0tZmlsdGVyPWV4Y2x1ZGVfLyR7aX0iICItLWZpbHRlcj1wcm90ZWN0Xy8ke2l9IikKZG9uZQpfUlNZTkMrPSgKICAiLS1maWx0ZXI9aW5jbHVkZV8vcHJvamVjdC8iCiAgIi0tZmlsdGVyPXByb3RlY3RfL3Byb2plY3QvIgogICItLWZpbHRlcj1pbmNsdWRlXy9wcm9qZWN0L3RyYWNlLyIKICAiLS1maWx0ZXI9cHJvdGVjdF8vcHJvamVjdC90cmFjZS8iCiAgIi0tZmlsdGVyPWluY2x1ZGVfL3Byb2plY3QvdHJhY2UvKiIKKQoKIyBEZWZhdWx0IHJzeW5jIG9wdGlvbnMgZm9yICpldmVyeSogcnN5bmMgY2FsbAojIE5vdyBhZGQgdGhlIGJ3bGltaXQgb3B0aW9uLiBBcyBkZWZhdWx0IGlzIDAgd2UgYWx3YXlzIGFkZCBpdCwgcnN5bmMgaW50ZXJwcmV0cwojIDAgYXMgdW5saW1pdGVkLCBzbyB0aGlzIGlzIHNhZmUuCl9SU1lOQys9KCR7UlNZTkNfRVhUUkF9IC0tYndsaW1pdD0ke1JTWU5DX0JXfSAke1JTWU5DX09QVElPTlN9ICR7RVhDTFVERX0pCgojIGNvbGxlY3Qgc29tZSBzdGF0cwpTVEFUU19UT1RBTF9SU1lOQ19USU1FMT0wClNUQVRTX1RPVEFMX1JTWU5DX1RJTUUyPTAKCiMgVGhlIHRlbXAgZGlyZWN0b3J5IHVzZWQgYnkgcnN5bmMgLS1kZWxheS11cGRhdGVzIGlzIG5vdAojIHdvcmxkLXJlYWRhYmxlIHJlbW90ZWx5LiBBbHdheXMgZXhjbHVkZSBpdCB0byBhdm9pZCBlcnJvcnMuCl9SU1lOQys9KCItLWV4Y2x1ZGU9Ln50bXB+LyIpCgppZiBbWyAke1JTWU5DX1RSQU5TUE9SVH0gPSB1bmRlZmluZWQgXV07IHRoZW4KICAgIDoKZWxpZiBbWyAke1JTWU5DX1RSQU5TUE9SVH0gPSBzc2ggXV07IHRoZW4KICAgIF9SU1lOQys9KC1lICJzc2giKQplbGlmIFtbICR7UlNZTkNfVFJBTlNQT1JUfSA9IHNzbCBdXTsgdGhlbgogICAgZXhwb3J0IFJTWU5DX1NTTF9QT1JUCiAgICBleHBvcnQgUlNZTkNfU1NMX0NBUEFUSAogICAgZXhwb3J0IFJTWU5DX1NTTF9NRVRIT0QKICAgIF9SU1lOQys9KC1lICIke0JJTkRJUjorJHtCSU5ESVJ9L31yc3luYy1zc2wtdHVubmVsIikKZWxzZQogICAgZWNobyAiVW5rbm93biByc3luYyB0cmFuc3BvcnQgY29uZmlndXJlZCAoJHtSU1lOQ19UUkFOU1BPUlR9KSIgPiYyCiAgICBleGl0IDEKZmkKCiMgRXhjbHVkZSBhcmNoaXRlY3R1cmVzIGRlZmluZWQgaW4gJEFSQ0hfRVhDTFVERQpzZXRfZXhjbHVkZV9pbmNsdWRlX2FyY2hzCgojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKIyBSZWFsbHkgbm90aGluZyB0byBzZWUgYmVsb3cgaGVyZS4gT25seSBjb2RlIGZvbGxvd3MuICAgICAgICAgICAgICAgICAjCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKREFURV9TVEFSVEVEPSQoTENfQUxMPVBPU0lYIExBTkc9UE9TSVggZGF0ZSAtdSAtUikKCiMgU29tZSBzYW5lIGRlZmF1bHRzCmNkICIke0JBU0VESVI6LX0iCnVtYXNrIDAyMgoKIyBJZiB3ZSBhcmUgaGVyZSBmb3IgdGhlIGZpcnN0IHRpbWUsIGNyZWF0ZSB0aGUKIyBkZXN0aW5hdGlvbiBhbmQgdGhlIHRyYWNlIGRpcmVjdG9yeQpta2RpciAtcCAiJHtUT30vJHtUUkFDRURJUn0iCgojIFVzZWQgdG8gbWFrZSBzdXJlIHdlIHdpbGwgaGF2ZSB0aGUgYXJjaGl2ZSBmdWxseSBhbmQgY29tcGxldGx5IHN5bmNlZCBiZWZvcmUKIyB3ZSBzdG9wLCBldmVuIGlmIHdlIGdldCBtdWx0aXBsZSBwdXNoZXMgd2hpbGUgdGhpcyBzY3JpcHQgaXMgcnVubmluZy4KIyBPdGhlcndpc2Ugd2UgY2FuIGVuZCB1cCB3aXRoIGEgaGFsZi1zeW5jZWQgYXJjaGl2ZToKIyAtIGdldCBhIHB1c2gKIyAtIHN5bmMsIHdoaWxlIGxvY2tlZAojIC0gZ2V0IGFub3RoZXIgcHVzaC4gT2YgY291cnNlIG5vIGV4dHJhIHN5bmMgcnVuIHRoZW4gaGFwcGVucywgd2UgYXJlIGxvY2tlZC4KIyAtIGRvbmUuIEFyY2hpdmUgbm90IGNvcnJlY3RseSBzeW5jZWQsIHdlIGRvbid0IGhhdmUgYWxsIHRoZSBjaGFuZ2VzIGZyb20gdGhlIHNlY29uZCBwdXNoLgp0b3VjaCAiJHtVUERBVEVSRVFVSVJFRH0iCgojIENoZWNrIHRvIHNlZSBpZiBhbm90aGVyIHN5bmMgaXMgaW4gcHJvZ3Jlc3MKaWYgISAoIHNldCAtbyBub2Nsb2JiZXI7IGVjaG8gIiQkIiA+ICIke0xPQ0t9IikgMj4gL2Rldi9udWxsOyB0aGVuCiAgICBpZiBbWyAke0JBU0hfVkVSU0lORk9bMF19IC1ndCAzIF1dIHx8IFtbIC1MIC9wcm9jL3NlbGYgXV07IHRoZW4KICAgICAgICAjIFdlIGhhdmUgYSByZWNlbnQgZW5vdWdoIGJhc2ggdmVyc2lvbiwgbGV0cyBkbyBpdCB0aGUgZWFzeSB3YXksCiAgICAgICAgIyB0aGUgbG9jayB3aWxsIGNvbnRhaW4gdGhlIHJpZ2h0IHBpZCwgdGhhbmtzIHRvICRCQVNIUElECiAgICAgICAgaWYgISAkKGtpbGwgLTAgJCg8ICR7TE9DS30pIDI+L2Rldi9udWxsKTsgdGhlbgogICAgICAgICAgICAjIFByb2Nlc3MgZG9lcyBlaXRoZXIgbm90IGV4aXN0IG9yIGlzIG5vdCBvd25lZCBieSB1cy4KICAgICAgICAgICAgZWNobyAiJCQiID4gIiR7TE9DS30iCiAgICAgICAgZWxzZQogICAgICAgICAgICBlY2hvICJVbmFibGUgdG8gc3RhcnQgcnN5bmMsIGxvY2sgZmlsZSBzdGlsbCBleGlzdHMsIFBJRCAkKDwgJHtMT0NLfSkiCiAgICAgICAgICAgIGV4aXQgMQogICAgICAgIGZpCiAgICBlbHNlCiAgICAgICAgIyBPbGQgYmFzaCwgbWVhbnMgd2UgZG9udCBoYXZlIHRoZSByaWdodCBwaWQgaW4gb3VyIGxvY2tmaWxlCiAgICAgICAgIyBTbyB0YWtlIGEgZGlmZmVyZW50IHdheSAtIGd1ZXNzIGlmIGl0IGlzIHN0aWxsIHRoZXJlIGJ5IGNvbXBhcmluZyBpdHMgYWdlLgogICAgICAgICMgTm90IG9wdGltYWwsIGJ1dCBoZXkuCiAgICAgICAgc3RhbXB0aW1lPSQoZGF0ZSAtLXJlZmVyZW5jZT0iJHtMT0NLfSIgKyVzKQogICAgICAgIHVuaXh0aW1lPSQoZGF0ZSArJXMpCiAgICAgICAgZGlmZmVyZW5jZT0kKCggJHVuaXh0aW1lIC0gJHN0YW1wdGltZSApKQogICAgICAgIGlmIFtbICR7ZGlmZmVyZW5jZX0gLWdlICR7TE9DS1RJTUVPVVR9IF1dOyB0aGVuCiAgICAgICAgICAgICMgVG9vayBsb25nZXIgdGhhbiBMT0NLVElNRU9VVCBtaW51dGVzPyBBc3N1bWUgaXQgYnJva2UgYW5kIHRha2UgdGhlIGxvY2sKICAgICAgICAgICAgZWNobyAiJCQiID4gIiR7TE9DS30iCiAgICAgICAgZWxzZQogICAgICAgICAgICBlY2hvICJVbmFibGUgdG8gc3RhcnQgcnN5bmMsIGxvY2sgZmlsZSB5b3VuZ2VyIHRoYW4gb25lIGhvdXIiCiAgICAgICAgICAgIGV4aXQgMQogICAgICAgIGZpCiAgICBmaQpmaQoKIyBXZSB3YW50IHRvIGNsZWFudXAgYWx3YXlzCnRyYXAgY2xlYW51cCBFWElUIFRFUk0gSFVQIElOVCBRVUlUCgojIE9wZW4gbG9nIGFuZCBjbG9zZSBzdGRpbgpvcGVuX2xvZyAkTE9HCmV4ZWMgMj4mMSA8Ji0KbG9nICJNaXJyb3JzeW5jIHN0YXJ0IgoKIyBMb29rIHdobyBwdXNoZWQgdXMgYW5kIG5vdGUgdGhhdCBpbiB0aGUgbG9nLgpTU0hfQ09OTkVDVElPTj0ke1NTSF9DT05ORUNUSU9OOi0iIn0KUFVTSEZST009IiR7U1NIX0NPTk5FQ1RJT04lJVwgKn0iCmlmIFtbIC1uICR7UFVTSEZST019IF1dOyB0aGVuCiAgICBsb2cgIldlIGdvdCBwdXNoZWQgZnJvbSAke1BVU0hGUk9NfSIKZmkKCmlmIFtbIHRydWUgPSAke1NZTkNDQUxMQkFDS30gXV07IHRoZW4KICAgIGlmIFtbIG5vbmUgPSAke0NBTExCQUNLSE9TVH0gXV0gfHwgW1sgbm9uZSA9ICR7Q0FMTEJBQ0tLRVl9IF1dOyB0aGVuCiAgICAgICAgU1lOQ0NBTExCQUNLPSJmYWxzZSIKICAgICAgICBlcnJvciAiV2UgYXJlIGFza2VkIHRvIGNhbGwgYmFjaywgYnV0IHdlIGRvIG5vdCBrbm93IHdoZXJlIHRvIGFuZCBkbyBub3QgaGF2ZSBhIGtleSwgaWdub3JpbmcgY2FsbGJhY2siCiAgICBmaQpmaQoKSE9PSz0oCiAgICBIT09LTlI9MQogICAgSE9PS1NDUj0ke0hPT0sxfQopCmhvb2sgJEhPT0sKCiMgTm93LCB3ZSBtaWdodCB3YW50IHRvIHN5bmMgZnJvbSBhbm9ueW1vdXMgdG9vLgojIFRoaXMgaXMgdGhhdCBkZWVwIGluIHRoaXMgc2NyaXB0IHNvIGhvb2sxIGNvdWxkLCBpZiB3YW50ZWQsIGNoYW5nZSB0aGluZ3MhCmlmIFtbIC16ICR7UlNZTkNfU09VUkNFOi19IF1dOyB0aGVuCiAgICBpZiBbWyAteiAke1JTWU5DX1VTRVI6LX0gXV07IHRoZW4KICAgICAgICBSU1lOQ19TT1VSQ0U9IiR7UlNZTkNfSE9TVH06OiR7UlNZTkNfUEFUSH0iCiAgICBlbHNlCiAgICAgICAgUlNZTkNfU09VUkNFPSIke1JTWU5DX1VTRVJ9QCR7UlNZTkNfSE9TVH06OiR7UlNZTkNfUEFUSH0iCiAgICBmaQpmaQoKX1JTWU5DKz0oIiR7UlNZTkNfU09VUkNFfSIgIiRUTyIpCgojIE5vdyBkbyB0aGUgYWN0dWFsIG1pcnJvcmluZywgYW5kIHJ1biBhcyBsb25nIGFzIHdlIGhhdmUgYW4gdXBkYXRlcmVxdWlyZWQgZmlsZS4KZXhwb3J0IFJTWU5DX1BBU1NXT1JECmV4cG9ydCBSU1lOQ19QUk9YWQoKVVBEQVRFX1JFVFJJRVM9MAoKd2hpbGUgW1sgLWUgJHtVUERBVEVSRVFVSVJFRH0gXV07IGRvCiAgICBsb2cgIlJ1bm5pbmcgbWlycm9yc3luYywgdXBkYXRlIGlzIHJlcXVpcmVkLCAke1VQREFURVJFUVVJUkVEfSBleGlzdHMiCgogICAgIyBpZiB3ZSB3YW50IHN0YWdlMSAqb3IqIGFsbAogICAgaWYgW1sgdHJ1ZSA9ICR7U1lOQ1NUQUdFMX0gXV0gfHwgW1sgdHJ1ZSA9ICR7U1lOQ0FMTH0gXV07IHRoZW4KICAgICAgICB3aGlsZSBbWyAtZSAke1VQREFURVJFUVVJUkVEfSBdXTsgZG8KICAgICAgICAgICAgcm0gLWYgIiR7VVBEQVRFUkVRVUlSRUR9IgogICAgICAgICAgICAjIFN0ZXAgb25lLCBzeW5jIGV2ZXJ5dGhpbmcgZXhjZXB0IFBhY2thZ2VzL1JlbGVhc2VzCiAgICAgICAgICAgIHJzeW5jX3N0YXJ0ZWQ9JChkYXRlICslcykKICAgICAgICAgICAgcmVzdWx0PTAKICAgICAgICAgICAgcnVuX3JzeW5jICJzdGFnZTEiICR7UlNZTkNfT1BUSU9OUzF9IHx8IHJlc3VsdD0kPwogICAgICAgICAgICByc3luY19lbmRlZD0kKGRhdGUgKyVzKQogICAgICAgICAgICBTVEFUU19UT1RBTF9SU1lOQ19USU1FMT0kKCggU1RBVFNfVE9UQUxfUlNZTkNfVElNRTEgKyByc3luY19lbmRlZCAtIHJzeW5jX3N0YXJ0ZWQgKSkKCiAgICAgICAgICAgIGxvZyAiQmFjayBmcm9tIHJzeW5jIHdpdGggcmV0dXJuY29kZSAke3Jlc3VsdH0iCiAgICAgICAgZG9uZQogICAgZWxzZQogICAgICAgIHRpbWUxPSQoZXh0cmFjdF90cmFjZV9maWVsZCAnVG90YWwgdGltZSBzcGVudCBpbiBzdGFnZTEgcnN5bmMnICIke1RPfS8ke1RSQUNFX1NUQUdFMX0iIHx8IDopCiAgICAgICAgaWYgW1sgJHRpbWUxIF1dOyB0aGVuCiAgICAgICAgICAgIFNUQVRTX1RPVEFMX1JTWU5DX1RJTUUxPSIkdGltZTEiCiAgICAgICAgZmkKICAgICAgICAjIEZha2UgYSBnb29kIHJlc3VsdGNvZGUKICAgICAgICByZXN1bHQ9MAogICAgZmkgIyBTeW5jIHN0YWdlIDE/CiAgICBybSAtZiAiJHtVUERBVEVSRVFVSVJFRH0iCgogICAgc2V0ICtlCiAgICBjaGVja19yc3luYyAkcmVzdWx0ICJTeW5jIHN0ZXAgMSB3ZW50IHdyb25nLCBnb3QgZXJyb3Jjb2RlICR7cmVzdWx0fS4gTG9nZmlsZTogJHtMT0d9IgogICAgR089JD8KICAgIHNldCAtZQogICAgaWYgW1sgJHtHT30gLWVxIDIgXV0gJiYgW1sgLWUgJHtVUERBVEVSRVFVSVJFRH0gXV07IHRoZW4KICAgICAgICBsb2cgIldlIGdvdCBlcnJvciAke3Jlc3VsdH0gZnJvbSByc3luYywgYnV0IGEgc2Vjb25kIHB1c2ggd2VudCBpbiBoZW5jZSBpZ25vcmluZyB0aGlzIGVycm9yIGZvciBub3ciCiAgICBlbGlmIFtbICR7R099IC1uZSAwIF1dOyB0aGVuCiAgICAgICAgZXhpdCAzCiAgICBmaQoKICAgIEhPT0s9KAogICAgICAgIEhPT0tOUj0yCiAgICAgICAgSE9PS1NDUj0ke0hPT0syfQogICAgKQogICAgaG9vayAkSE9PSwoKICAgICMgaWYgd2Ugd2FudCBzdGFnZTIgKm9yKiBhbGwKICAgIGlmIFtbIHRydWUgPSAke1NZTkNTVEFHRTJ9IF1dIHx8IFtbIHRydWUgPSAke1NZTkNBTEx9IF1dOyB0aGVuCiAgICAgICAgdXBzdHJlYW1fdWlwPWZhbHNlCiAgICAgICAgZm9yIGF1cGZpbGUgaW4gIiR7VE99L0FyY2hpdmUtVXBkYXRlLWluLVByb2dyZXNzLSIqOyBkbwogICAgICAgICAgICBjYXNlICIkYXVwZmlsZSIgaW4KICAgICAgICAgICAgICAgICIke1RPfS9BcmNoaXZlLVVwZGF0ZS1pbi1Qcm9ncmVzcy0qIikKICAgICAgICAgICAgICAgICAgICBlcnJvciAiTG9jayBmaWxlIGlzIG1pc3NpbmcsIHRoaXMgc2hvdWxkIG5vdCBoYXBwZW4iCiAgICAgICAgICAgICAgICAgICAgOzsKICAgICAgICAgICAgICAgICIke0xPQ0t9IikKICAgICAgICAgICAgICAgICAgICA6CiAgICAgICAgICAgICAgICAgICAgOzsKICAgICAgICAgICAgICAgICopCiAgICAgICAgICAgICAgICAgICAgaWYgW1sgLWYgJGF1cGZpbGUgXV07IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgIyBSZW1vdmUgdGhlIGZpbGUsIGl0IHdpbGwgYmUgc3luY2VkIGFnYWluIGlmCiAgICAgICAgICAgICAgICAgICAgICAgICMgdXBzdHJlYW0gaXMgc3RpbGwgbm90IGRvbmUKICAgICAgICAgICAgICAgICAgICAgICAgcm0gLWYgIiRhdXBmaWxlIgogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgbG9nICJBVUlQIGZpbGUgJyRhdXBmaWxlJyBpcyBub3QgcmVhbGx5IGEgZmlsZSwgd2VpcmQiCiAgICAgICAgICAgICAgICAgICAgZmkKICAgICAgICAgICAgICAgICAgICB1cHN0cmVhbV91aXA9dHJ1ZQogICAgICAgICAgICAgICAgICAgIDs7CiAgICAgICAgICAgIGVzYWMKICAgICAgICBkb25lCgogICAgICAgIGlmIFtbIHRydWUgPSAke3Vwc3RyZWFtX3VpcH0gXV07IHRoZW4KICAgICAgICAgICAgbG9nICJVcHN0cmVhbSBhcmNoaXZlIHVwZGF0ZSBpbiBwcm9ncmVzcywgc2tpcHBpbmcgc3RhZ2UyIgogICAgICAgICAgICBpZiBbWyAke1VQREFURV9SRVRSSUVTfSAtbHQgJHtVSVBSRVRSSUVTfSBdXTsgdGhlbgogICAgICAgICAgICAgICAgbG9nICJSZXRyeWluZyB1cGRhdGUgaW4gJHtVSVBTTEVFUH0iCiAgICAgICAgICAgICAgICB0b3VjaCAiJHtVUERBVEVSRVFVSVJFRH0iCiAgICAgICAgICAgICAgICBVUERBVEVfUkVUUklFUz0kKCgkVVBEQVRFX1JFVFJJRVMrMSkpCiAgICAgICAgICAgICAgICBzbGVlcCAiJHtVSVBTTEVFUH0iCiAgICAgICAgICAgICAgICByZXN1bHQ9MAogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBlcnJvciAiVXBkYXRlIGhhcyBiZWVuIHJldHJpZWQgJHtVUERBVEVfUkVUUklFU30gdGltZXMsIGFib3J0aW5nIgogICAgICAgICAgICAgICAgbG9nICJQZXJoYXBzIHVwc3RyZWFtIGlzIHN0aWxsIHVwZGF0aW5nIG9yIHRoZXJlJ3MgYSBzdGFsZSBBVUlQIGZpbGUiCiAgICAgICAgICAgICAgICByZXN1bHQ9MQogICAgICAgICAgICBmaQogICAgICAgIGVsc2UKICAgICAgICAgICAgIyBXZSBhcmUgbHVja3ksIGl0IHdvcmtlZC4gTm93IGRvIHN0ZXAgMiBhbmQgc3luYyBhZ2FpbiwgdGhpcyB0aW1lIGluY2x1ZGluZwogICAgICAgICAgICAjIHRoZSBwYWNrYWdlcy9yZWxlYXNlcyBmaWxlcwogICAgICAgICAgICByc3luY19zdGFydGVkPSQoZGF0ZSArJXMpCiAgICAgICAgICAgIHJlc3VsdD0wCiAgICAgICAgICAgIHJ1bl9yc3luYyAic3RhZ2UyIiAke1JTWU5DX09QVElPTlMyfSB8fCByZXN1bHQ9JD8KICAgICAgICAgICAgcnN5bmNfZW5kZWQ9JChkYXRlICslcykKICAgICAgICAgICAgU1RBVFNfVE9UQUxfUlNZTkNfVElNRTI9JCgoIFNUQVRTX1RPVEFMX1JTWU5DX1RJTUUyICsgcnN5bmNfZW5kZWQgLSByc3luY19zdGFydGVkICkpCgogICAgICAgICAgICBsb2cgIkJhY2sgZnJvbSByc3luYyB3aXRoIHJldHVybmNvZGUgJHtyZXN1bHR9IgogICAgICAgIGZpCiAgICBlbHNlCiAgICAgICAgIyBGYWtlIGEgZ29vZCByZXN1bHRjb2RlCiAgICAgICAgcmVzdWx0PTAKICAgIGZpICMgU3luYyBzdGFnZSAyPwoKICAgIHNldCArZQogICAgY2hlY2tfcnN5bmMgJHJlc3VsdCAiU3luYyBzdGVwIDIgd2VudCB3cm9uZywgZ290IGVycm9yY29kZSAke3Jlc3VsdH0uIExvZ2ZpbGU6ICR7TE9HfSIKICAgIEdPPSQ/CiAgICBzZXQgLWUKICAgIGlmIFtbICR7R099IC1lcSAyIF1dICYmIFtbIC1lICR7VVBEQVRFUkVRVUlSRUR9IF1dOyB0aGVuCiAgICAgICAgbG9nICJXZSBnb3QgZXJyb3IgJHtyZXN1bHR9IGZyb20gcnN5bmMsIGJ1dCBhIHNlY29uZCBwdXNoIHdlbnQgaW4gaGVuY2UgaWdub3JpbmcgdGhpcyBlcnJvciBmb3Igbm93IgogICAgZWxpZiBbWyAke0dPfSAtbmUgMCBdXTsgdGhlbgogICAgICAgIGV4aXQgNAogICAgZmkKCiAgICBIT09LPSgKICAgICAgICBIT09LTlI9MwogICAgICAgIEhPT0tTQ1I9JHtIT09LM30KICAgICkKICAgIGhvb2sgJEhPT0sKZG9uZQoKIyBXZSBvbmx5IHVwZGF0ZSBvdXIgdHJhY2VmaWxlIHdoZW4gd2UgaGFkIGEgc3RhZ2UyIG9yIGFuIGFsbCBzeW5jLgojIE90aGVyd2lzZSB3ZSB3b3VsZCB1cGRhdGUgaXQgYWZ0ZXIgc3RhZ2UxIGFscmVhZHksIHdoaWNoIGlzIHdyb25nLgppZiBbWyB0cnVlID0gJHtTWU5DU1RBR0UyfSBdXSB8fCBbWyB0cnVlID0gJHtTWU5DQUxMfSBdXTsgdGhlbgogICAgdHJhY2VmaWxlCiAgICBpZiBbWyB0cnVlID0gJHtTWU5DQUxMfSBdXTsgdGhlbgogICAgICAgIHJtIC1mICIke1RPfS8ke1RSQUNFX1NUQUdFMX0iCiAgICBmaQplbGlmIFtbIHRydWUgPSAke1NZTkNTVEFHRTF9IF1dOyB0aGVuCiAgICB0cmFjZWZpbGUgIiR7VE99LyR7VFJBQ0VfU1RBR0UxfSIKZmkKCgpIT09LPSgKICAgIEhPT0tOUj00CiAgICBIT09LU0NSPSR7SE9PSzR9CikKaG9vayAkSE9PSwoKaWYgW1sgdHJ1ZSA9ICR7U1lOQ0NBTExCQUNLfSBdXTsgdGhlbgogICAgc2V0ICtlCiAgICBjYWxsYmFjayAke0NBTExCQUNLVVNFUn0gJHtDQUxMQkFDS0hPU1R9ICIke0NBTExCQUNLS0VZfSIKICAgIHNldCAtZQpmaQoKIyBSZW1vdmUgdGhlIEFyY2hpdmUtVXBkYXRlLWluLVByb2dyZXNzIGZpbGUgYmVmb3JlIHdlIHB1c2ggb3VyIGRvd25zdHJlYW1zLgpybSAtZiAiJHtMT0NLfSIKCmRlY2xhcmUgLWYgLUYgc2VuZF9tYWlsX25ld192ZXJzaW9uID4gL2Rldi9udWxsICYmIHNlbmRfbWFpbF9uZXdfdmVyc2lvbiB8fCA6CgppZiBbWyAke0hVQn0gPSB0cnVlIF1dOyB0aGVuCiAgICAjIFRyaWdnZXIgc2xhdmUgbWlycm9ycyBpZiB3ZSBoYWQgYSBwdXNoIGZvciBzdGFnZTIgb3IgYWxsLCBvciBpZiBpdHMgbWhvcAogICAgaWYgW1sgdHJ1ZSA9ICR7U1lOQ1NUQUdFMn0gXV0gfHwgW1sgdHJ1ZSA9ICR7U1lOQ0FMTH0gXV0gfHwgW1sgdHJ1ZSA9ICR7U1lOQ01IT1B9IF1dOyB0aGVuCiAgICAgICAgUlVOTUlSUk9SQVJHUz0iIgogICAgICAgIGlmIFtbIC1uICR7QVJDSElWRX0gXV07IHRoZW4KICAgICAgICAgICAgIyBXZSB0ZWxsIHJ1bm1pcnJvcnMgYWJvdXQgdGhlIGFyY2hpdmUgd2UgYXJlIHJ1bm5pbmcgb24uCiAgICAgICAgICAgIFJVTk1JUlJPUkFSR1M9Ii1hICR7QVJDSElWRX0iCiAgICAgICAgZmkKICAgICAgICAjIFdlIGFsc28gdGVsbCBydW5taXJyb3JzIHRoYXQgd2UgYXJlIHJ1bm5pbmcgaXQgZnJvbSB3aXRoaW4gZnRwc3luYywgc28gaXQgY2FuIGNoYW5nZQogICAgICAgICMgdGhlIHdheSBpdCB3b3JrcyB3aXRoIG1ob3AgYmFzZWQgb24gdGhhdC4KICAgICAgICBSVU5NSVJST1JBUkdTPSIke1JVTk1JUlJPUkFSR1N9IC1mIgoKICAgICAgICBpZiBbWyB0cnVlID0gJHtTWU5DU1RBR0UxfSBdXTsgdGhlbgogICAgICAgICAgICAjIFRoaXMgaXMgdHJ1ZSB3aGVuIHdlIGhhdmUgYSBtaG9wIHN5bmMuIEEgbm9ybWFsIG11bHRpLXN0YWdlIHB1c2ggc2VuZGluZyBzdGFnZTEgd2lsbAogICAgICAgICAgICAjIG5vdCBnZXQgdG8gdGhpcyBwb2ludC4KICAgICAgICAgICAgIyBTbyBpZiB0aGF0IGhhcHBlbnMsIHRlbGwgcnVubWlycm9ycyB3ZSBhcmUgZG9pbmcgbWhvcAogICAgICAgICAgICBSVU5NSVJST1JBUkdTPSIke1JVTk1JUlJPUkFSR1N9IC1rIG1ob3AiCiAgICAgICAgZWxpZiBbWyB0cnVlID0gJHtTWU5DU1RBR0UyfSBdXTsgdGhlbgogICAgICAgICAgICBSVU5NSVJST1JBUkdTPSIke1JVTk1JUlJPUkFSR1N9IC1rIHN0YWdlMiIKICAgICAgICBlbGlmIFtbIHRydWUgPSAke1NZTkNBTEx9IF1dOyB0aGVuCiAgICAgICAgICAgIFJVTk1JUlJPUkFSR1M9IiR7UlVOTUlSUk9SQVJHU30gLWsgYWxsIgogICAgICAgIGZpCiAgICAgICAgbG9nICJUcmlnZ2VyIHNsYXZlIG1pcnJvcnMgdXNpbmcgJHtSVU5NSVJST1JBUkdTfSIKICAgICAgICAke0JJTkRJUjorJHtCSU5ESVJ9L31ydW5taXJyb3JzICR7UlVOTUlSUk9SQVJHU30KICAgICAgICBsb2cgIlRyaWdnZXIgc2xhdmUgZG9uZSIKCiAgICAgICAgSE9PSz0oCiAgICAgICAgICAgIEhPT0tOUj01CiAgICAgICAgICAgIEhPT0tTQ1I9JHtIT09LNX0KICAgICAgICApCiAgICAgICAgaG9vayAkSE9PSwogICAgZmkKZmkK"""